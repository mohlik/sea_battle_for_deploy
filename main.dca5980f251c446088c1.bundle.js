/*! For license information please see main.dca5980f251c446088c1.bundle.js.LICENSE.txt */
(()=>{var e,t={493:(e,t,i)=>{"use strict";i.d(t,{l:()=>re});var s=i(260),a=i.n(s);class n extends a().GameObjects.Container{constructor(e,t){super(e),this.init(t)}init(e){const{atlas:t,frame_bg:i,frame_bar:s}=e;i&&(this.bg=new(a().GameObjects.Image)(this.scene,0,0,t||i,t?i:void 0),this.add(this.bg)),this.bar=new(a().GameObjects.Image)(this.scene,0,0,t||s,t?s:void 0),this.add(this.bar),this.update_progress(0)}update_progress(e){this.bar.setCrop(0,0,e*this.bar.width,this.bar.height)}}var o=i(238);const h="https://sea-battle-api-staging.archdrdr.online/",r="SEA_BATTLE_ACCESS_TOKEN",l=r;var c=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function o(e){try{r(s.next(e))}catch(e){n(e)}}function h(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,h)}r((s=s.apply(e,t||[])).next())}))};class d{static refresh(){return c(this,void 0,void 0,(function*(){return f.post("/v1/auth/refresh-tokens")}))}static login(e,t){return c(this,void 0,void 0,(function*(){return f.post("/v1/auth/sign-in",e,t)}))}}var _=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function o(e){try{r(s.next(e))}catch(e){n(e)}}function h(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,h)}r((s=s.apply(e,t||[])).next())}))};function m(e){return!e.headers||e.headers["Skip-Auth-Refresh"]||(e.headers.Authorization=`Bearer ${localStorage.getItem(l)}`),e}function g(e){return _(this,void 0,void 0,(function*(){return e.data}))}function p(e){return _(this,void 0,void 0,(function*(){var t;const i=e.response;if(null===(t=e.config)||void 0===t?void 0:t.headers["Skip-Auth-Refresh"])return Promise.reject(null==i?void 0:i.data);if(401===(null==i?void 0:i.status)){const t=e.config;try{const e=yield d.refresh();return localStorage.setItem(l,e.accessToken),f.request(t)}catch(e){return Promise.reject(i)}}return Promise.reject(i)}))}var w=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function o(e){try{r(s.next(e))}catch(e){n(e)}}function h(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,h)}r((s=s.apply(e,t||[])).next())}))};const b=h,f=new class{constructor(){this.entity=null,this.init()}init(){this.entity=o.Z.create({withCredentials:!0,baseURL:b}),this.entity.interceptors.request.use(m),this.entity.interceptors.response.use(g,p)}request(e){return w(this,void 0,void 0,(function*(){try{return yield this.entity.request(e)}catch(e){return Promise.reject(e)}}))}get(e,t){return w(this,void 0,void 0,(function*(){return this.request(Object.assign(Object.assign({},t),{method:"GET",url:e}))}))}post(e,t,i){return w(this,void 0,void 0,(function*(){return this.request(Object.assign(Object.assign({},i),{method:"POST",url:e,data:t}))}))}put(e,t,i){return w(this,void 0,void 0,(function*(){return this.request(Object.assign(Object.assign({},i),{method:"PUT",url:e,data:t}))}))}delete(e,t){return w(this,void 0,void 0,(function*(){return this.request(Object.assign(Object.assign({},t),{method:"DELETE",url:e}))}))}login(e){return w(this,void 0,void 0,(function*(){return this.post("/v1/auth/sign-in",e)}))}};var u=function(e,t,i,s){return new(i||(i=Promise))((function(a,n){function o(e){try{r(s.next(e))}catch(e){n(e)}}function h(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,h)}r((s=s.apply(e,t||[])).next())}))};const y={width:0,height:0},x={cell_width:67,user_data:{name:"Player",rank:{stage:"sergant",score:890,to_up:1e3},rating:{score:999},coins:0,gems:0,oil:{amount:1e3,max:1e3},daily_reward:{amount:0},skills:{atom:{amount:0},bomber:{amount:0},fighter:{amount:0},torpedo:{amount:0},submarine:{amount:0},radar:{amount:0},airdef:{amount:0},mine:{amount:0}},statistic:{wins:0,loses:0},lang:"en_US",game_syles:{ships:"default",ava:"default",frame:"default",bg:"default"},flag:"UA",personalization:{avatars:["default","default","default","default","default","default","default","default"],frames:["default","default","default","default","default","default","default","default"],feet:["default","default"],backgrounds:["default","default"]}},personalization_data:{avatars:{default:{src:"",atlas:"",frame:""}}},shop:{personalization:{avatars:[{type:"avatar",price:100,valute:"gold"}]},purchase_items:[{type:"coins",id:"coin_1",price:.99,icon:"coin_1",items:{money:200}},{type:"coins",id:"coin_2",price:1.99,icon:"coin_2",items:{money:500}},{type:"coins",id:"coin_3",price:2.99,icon:"coin_3",items:{money:1100}},{type:"coins",id:"coin_4",price:3.99,icon:"coin_4",items:{money:2500}},{type:"coins",id:"coin_5",price:4.99,icon:"coin_5",items:{money:7e3}},{type:"gems",id:"gem_1",price:.99,icon:"gem_1",items:{gems:50}},{type:"gems",id:"gem_2",price:1.99,icon:"gem_2",items:{gems:110}},{type:"gems",id:"gem_3",price:2.99,icon:"gem_3",items:{gems:250}},{type:"gems",id:"gem_4",price:3.99,icon:"gem_4",items:{gems:600}},{type:"gems",id:"gem_5",price:4.99,icon:"gem_5",items:{gems:1500}}]},game_play:{with_bot:!0,advanced:!0,fields:[],socket_field:{},default_rules:{ships:{boats:[4,3,2,1],bombs:0},filling:20}},skills:{atom:{price:300,max:1},bomber:{price:200,max:2},fighter:{price:150,max:3},torpedo:{price:150,max:2},submarine:{price:200,max:2},radar:{price:150,max:1},airdef:{price:120,max:3},mine:{price:50,max:4}},daily_rewards:[{type:"coins",amount:100,icon:"coin_1"},{type:"coins",amount:200,icon:"coin_1"},{type:"coins",amount:300,icon:"coin_1"},{type:"coins",amount:400,icon:"coin_1"},{type:"coins",amount:500,icon:"coin_1"},{type:"coins",amount:600,icon:"coin_1"},{type:"coins",amount:700,icon:"coin_1"},{type:"coins",amount:800,icon:"coin_1"},{type:"coins",amount:900,icon:"coin_1"},{type:"coins",amount:1e3,icon:"coin_1"},{type:"coins",amount:1100,icon:"coin_1"},{type:"coins",amount:1200,icon:"coin_1"},{type:"coins",amount:1300,icon:"coin_1"},{type:"coins",amount:1400,icon:"coin_1"}]};let k;const O=1920,v=1080,G=new class{constructor(){this.web_app=window.Telegram.WebApp,this.init()}init(){parseFloat(this.web_app.version)>=8?this.web_app.requestFullscreen():console.error("Требуется версия Telegram 8.0+")}auth(){return u(this,void 0,void 0,(function*(){const e=this.web_app.initData;try{const t=yield f.post("/v1/auth/sign-in",{telegramToken:e},{headers:{"Skip-Auth-Refresh":!0}});return localStorage.setItem(l,t.accessToken),{success:!0,response:t}}catch(e){return{success:!1,error:e}}}))}get_user_data(){return u(this,void 0,void 0,(function*(){try{return{success:!0,response:yield f.get("/v1/users/me")}}catch(e){return{success:!1,error:e}}}))}change_name(e){return u(this,void 0,void 0,(function*(){try{const t=yield f.put("/v1/users/me/name",{name:e});return x.user_data.name=t.name,{success:!0,response:t}}catch(e){return{success:!1,error:e}}}))}change_flag(e){return u(this,void 0,void 0,(function*(){try{return{success:!0,response:yield f.put("/v1/users/me/flag",{flag:e})}}catch(e){return{success:!1,error:e}}}))}};class j extends a().Scene{constructor(){super("Boot")}preload(){const e=this.get_game_size();this.scale.setGameSize(e.W,e.H),this.load.plugin("rexshakepositionplugin","https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexshakepositionplugin.min.js",!0),this.load.plugin("rexinputtextplugin","https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexinputtextplugin.min.js",!0),this.load.image("loading_bg","assets/preload/loading_bg.png"),this.load.image("loader_bg","assets/preload/loader_bg.png"),this.load.image("loader_bar","assets/preload/loader_bar.png"),this.load.image("page_bg","assets/bgs/page_bg.png"),this.load.once("complete",this.create_loader,this)}create_loader(){const e=this.add.image(0,0,"loading_bg");e.setOrigin(0,0),e.setScale(y.width/e.width,y.height/e.height),this.loader=new n(this,{frame_bar:"loader_bar",frame_bg:"loader_bg"}),this.loader.x=y.width/2,this.loader.y=y.height/2,this.add.existing(this.loader),this.load.once("complete",(()=>{e.destroy(),this.loader.destroy(),this.create_game()})),this.preload_files()}preload_files(){this.load.on("progress",(e=>{this.loader.update_progress(e)})),this.load.pack("assets_pack","assets/assets_pack.json","images"),this.load.atlas("game_play","assets/game_play_atlas.png","assets/game_play_atlas.json"),this.load.atlas("new","assets/new_atlas.png","assets/new_atlas.json"),this.load.atlas("skill_anim","assets/skill_anim_atlas.png","assets/skill_anim_atlas.json"),this.load.atlas("game_menu","assets/game_menu.png","assets/game_menu.json"),this.load.atlas("shop","assets/shop.png","assets/shop.json"),this.load.atlas("flags","assets/flags.png","assets/flags.json"),this.load.json("map_items","assets/data/map_items.json"),this.load.font("rubik","assets/fonts/RubikMarkerHatch-Regular.ttf","truetype"),this.load.start()}create_game(){if("localhost"===location.hostname||"127.0.0.1"===location.hostname)return k=new re(this),this.add.existing(k),void k.init();this.tg_api=G,this.tg_api.auth().then((e=>{e.success?this.tg_api.get_user_data().then((e=>{var t,i,s;if(console.log(e.response),(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.name)&&(x.user_data.name=e.response.name),(null===(i=null==e?void 0:e.response)||void 0===i?void 0:i.flag)&&(x.user_data.flag=e.response.flag),null===(s=null==e?void 0:e.response)||void 0===s?void 0:s.balance){const t=e.response.balance;t.coins&&(x.user_data.coins=t.coins),t.diamonds&&(x.user_data.gems=t.diamonds),t.oil&&(x.user_data.oil.amount=t.coins)}k=new re(this),this.add.existing(k),k.init()})).catch((e=>{console.error(e),setTimeout((()=>this.create_game()),500)})):setTimeout((()=>this.create_game()),500)})).catch((()=>{setTimeout((()=>this.create_game()),500)}))}get_game_size(){return{W:window.innerWidth,H:window.innerHeight}}set_game_size(){const e=document.querySelector("canvas");let t,i;if(this&&this.scale.isFullscreen)t=window.innerWidth,i=window.innerHeight;else{const e=this.get_game_size();t=e.W,i=e.H}y.width=t,y.height=i;const s=1.7777777777777777;e&&(t/i<s?(e.style.width=t+"px",e.style.height=t/s+"px"):(e.style.height=i+"px",e.style.width=i*s+"px"))}update(){var e;(null===(e=null==k?void 0:k.game_menu)||void 0===e?void 0:e.game_map)&&k.game_menu.game_map.update()}}const F={type:a().AUTO,width:O,height:v,parent:"phaser_game",backgroundColor:"#111111",scale:{mode:a().Scale.FIT,autoCenter:a().Scale.CENTER_BOTH},scene:[j],dom:{createContainer:!0}};new(a().Game)(F),y.width=O,y.height=v;class S extends a().GameObjects.Container{constructor(e,t){super(e),this.init(t)}init(e){this.clickable=!0,this.x=e.x,this.y=e.y,this.callback=e.callback;const{atlas:t,frame_out:i}=e;let{frame_over:s,frame_down:n}=e,o=!1,h=!1;s||(o=!0,s=i),n||(h=!0,n=i),this.out_img=new(a().GameObjects.Image)(this.scene,0,0,t||i,t?i:void 0),this.over_img=new(a().GameObjects.Image)(this.scene,0,0,t||s,t?s:void 0),this.down_img=new(a().GameObjects.Image)(this.scene,0,0,t||n,t?n:void 0),this.add([this.out_img,this.over_img,this.down_img]),this.create_interactive(o,h)}create_interactive(e,t){this.out_img.setInteractive({useHandCursor:!0}),this.set_out(e||t),this.out_img.on("pointerdown",(()=>{this.clickable&&this.set_down(t)})),this.out_img.on("pointerover",(()=>{this.clickable&&this.set_over(e)})),this.out_img.on("pointerout",(()=>{this.clickable&&this.set_out(e||t)})),this.out_img.on("pointerup",(()=>{this.was_down&&(this.set_out(e||t),this.callback(this),this.was_down=!1)}))}set_handler(e){this.callback=e}setOrigin(e,t){t||0===t||(t=e),this.x-=(e-.5)*this.out_img.width,this.y-=(t-.5)*this.out_img.height}set_over(e){e||(this.over_img.visible=!0,this.down_img.visible=!1)}set_out(e){e?(this.over_img.visible=!1,this.down_img.visible=!1):(this.over_img.visible=!1,this.down_img.visible=!1,this.was_down=!1)}set_down(e){e||(this.over_img.visible=!1,this.down_img.visible=!0),this.was_down=!0}}var T=i(990);class I extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_static_images(),this.create_texts(),this.create_rank_bar(),this.cerate_interactive_images()}show(){}create_static_images(){const e=x.cell_width;let t;const i=new(a().GameObjects.Rectangle)(this.scene,y.width/2,y.height/2+1.5*e,y.width,y.height-3*e,0,1);i.alpha=1e-7,i.setInteractive(),i.on("pointerdown",(()=>{this.handler_blur()})),this.add(i),t=new(a().GameObjects.Image)(this.scene,7.5*e,3.5*e,"new","plank"),t.setScale(1.02,.98),this.add(t),t=new(a().GameObjects.Image)(this.scene,21.5*e,3.5*e,"new","plank"),t.setScale(1.02,.98),this.add(t),t=new(a().GameObjects.Image)(this.scene,7.5*e,14.5*e,"new","plank"),t.setScale(1.02,.98),this.add(t),t=new(a().GameObjects.Image)(this.scene,18.5*e,12.5*e,"new","plank"),t.setScale(.46,.98),this.add(t),t=new(a().GameObjects.Image)(this.scene,24.5*e,12.5*e,"new","plank"),t.setScale(.46,.98),this.add(t),t=new(a().GameObjects.Image)(this.scene,7.5*e,10*e,"new","name_back"),this.add(t);const s=new(a().GameObjects.Graphics)(this.scene);s.lineStyle(7,335737,1),s.lineBetween(15*e,3*e+3.5,15*e,y.height),s.lineStyle(7,13582392,1),s.lineBetween(16*e,5*e,27*e,5*e),s.lineBetween(16*e,11*e,27*e,11*e),this.add(s)}handler_blur(){console.log("blur"),this.input.setBlur(),"localhost"!==location.hostname&&this.scene.tg_api.change_name(this.input.text).then((()=>{k.game_menu.update_name()}))}handler_focus(){console.log("focus"),this.name_text.visible=!1,this.input.visible=!0,this.input.setText(this.name_text.text),this.input.setFocus(),this.input.setCursorPosition()}create_texts(){const e=x.cell_width;let t;t=new(a().GameObjects.Text)(this.scene,7.5*e,3.5*e,"INFORMATION",{fontFamily:"rubik",fontSize:36,color:"#ffffff"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,7.5*e,14.5*e,"UKRAINE",{fontFamily:"rubik",fontSize:36,color:"#ffffff"}),t.setOrigin(.5),t.setInteractive(),t.on("pointerup",(()=>{this.handler_edit_flag()})),this.add(t),t=new(a().GameObjects.Text)(this.scene,21.5*e,3.5*e,"STATISTICS",{fontFamily:"rubik",fontSize:36,color:"#ffffff"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,21.5*e,4.5*e,"FIGHTER STATISTIC",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,21.5*e,11.5*e,"MODE BATTLE STATISTIC",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,18.5*e,12.5*e,"CLASSIC",{fontFamily:"rubik",fontSize:28,color:"#ffffff"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,24.5*e,12.5*e,"ADVANCED",{fontFamily:"rubik",fontSize:28,color:"#ffffff"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,5.5*e,"SHIP SUNK:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,6.5*e,"CONSECUTIVE VICTORIES:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,7.5*e,"PERFECT VICTORIES:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,8.5*e,"VICTORIES IN TOURNAMENTS:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,9.5*e,"ADMIRALS DEFEATED:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,10.5*e,"FEET ADMIRALS DEFEATED:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,5.5*e,"89",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,6.5*e,"19",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,7.5*e,"9",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,8.5*e,"9",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,9.5*e,"92",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,10.5*e,"32",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e+5,13.5*e,"BATTLES:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,21*e-5,13.5*e,"999",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,16*e,14.5*e,"W:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,18.35*e,14.5*e,"99%",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,18.8*e,14.5*e,"L:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,21*e,14.5*e,"1%",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,22*e+5,13.5*e,"BATTLES:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e-5,13.5*e,"999",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,22*e,14.5*e,"W:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,24.35*e,14.5*e,"0%",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,24.8*e,14.5*e,"L:",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(0,.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,27*e,14.5*e,"100%",{fontFamily:"rubik",fontSize:40,color:"#DF2C2A"}),t.setOrigin(1,.5),this.add(t),this.name_text=new(a().GameObjects.Text)(this.scene,7.5*e,9.7*e,x.user_data.name,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),this.name_text.setOrigin(.5),this.add(this.name_text),this.input=new T.Z(this.scene,7.5*e,9.7*e,400,this.name_text.height,{type:"text",fontFamily:"rubik",fontSize:"36px",color:"#051F79",align:"center",maxLength:16}),this.input.on("keydown",((e,t)=>{"textarea"!==e.inputType&&"Enter"===t.key&&this.handler_blur()})),this.input.on("textchange",(()=>{this.name_text.text=this.input.text})),this.input.on("blur",(()=>{this.input.visible=!1,this.name_text.visible=!0})),this.input.on("click",(()=>{this.input.visible=!0,this.name_text.visible=!1})),this.name_text.setInteractive(),this.name_text.on("pointerup",(()=>{this.handler_focus()})),this.add(this.input)}create_rank_bar(){const e=x.cell_width;this.rank_bar=new n(this.scene,{atlas:"new",frame_bg:"plank",frame_bar:"oil_progress"}),this.rank_bar.bg.setScale(.73,1),this.rank_bar.update_progress(x.user_data.rank.score/x.user_data.rank.to_up),this.rank_bar.setPosition(7.5*e,11.5*e),this.rank_bar.setScale(.9,1),this.add(this.rank_bar);const t=new(a().GameObjects.Image)(this.scene,3.5*e+2,11.5*e+3,"new","rank_micro");t.scale=1.6,this.add(t),this.rank_bar_txt=new(a().GameObjects.Text)(this.scene,7.5*e,11.5*e,`${x.user_data.rank.score}/${x.user_data.rank.to_up}`,{fontFamily:"rubik",fontSize:36,strokeThickness:4,stroke:"#072279"}),this.rank_bar_txt.setOrigin(.5,.5),this.add(this.rank_bar_txt)}cerate_interactive_images(){const e=x.cell_width;let t;t=new(a().GameObjects.Image)(this.scene,7.5*e,6.6*e,"new","profile_ava"),t.scale=1.3,t.setInteractive(),t.on("pointerup",(()=>{this.handler_edit_ava()})),this.add(t),t=new(a().GameObjects.Image)(this.scene,12*e,4.5*e,"new","edit_icon"),t.setInteractive(),t.on("pointerup",(()=>{this.handler_edit_ava()})),this.add(t),t=new(a().GameObjects.Image)(this.scene,12*e,9.9*e,"new","edit_icon"),t.setInteractive(),t.on("pointerup",(()=>{this.handler_focus()})),this.add(t),t=new(a().GameObjects.Image)(this.scene,7.5*e,13.1*e,"new","edit_flag"),t.setInteractive(),t.on("pointerup",(()=>{this.handler_edit_flag()})),this.add(t),t=new(a().GameObjects.Image)(this.scene,11.1*e,11.5*e+3,"new","info_button"),t.setInteractive(),t.on("pointerup",(()=>{this.handler_rank_info()})),this.add(t)}handler_rank_info(){}handler_edit_ava(){k.big_windows.update_scenes("personalization")}handler_edit_name(){}handler_edit_flag(){k.big_windows.update_scenes("personalization")}handler_close(){this.handler_blur()}}class z extends a().GameObjects.Container{constructor(e,t){super(e),this.scene=e,this.init(t)}init(e){e.background?this.background=new(a().GameObjects.Image)(this.scene,0,0,e.background.texture?e.background.texture:e.background.frame,e.background.texture?e.background.frame:null).setOrigin(.5):this.background=new(a().GameObjects.Rectangle)(this.scene,0,0,e.width,e.height,16777215,0),e.scale&&this.background.setScale(e.scale.x,e.scale.y),e.tint&&this.background.setTint(e.tint),this.container=new(a().GameObjects.Container)(this.scene),this.add([this.background,this.container]),this.minus_y=this.background.getBounds().height/2*.95-20,this.minus_x=this.background.getBounds().width/2*.95;const{width:t,height:i}=this.background;this.setSize(t,i),this.setInteractive(),this.max_y=this.get_max_y()+20,this.was_move=!1,this.pointer_down=!1,this.on("pointerdown",(()=>{this.pointer_down=!0})).on("pointerup",(()=>{this.pointer_down=!1,this.was_move=!1})).on("pointerout",(()=>{this.pointer_down=!1,this.was_move=!1})).on("pointermove",(e=>{this.pointer_down&&(this.was_move=!0,this.updateScroll(e.position.y-e.prevPosition.y))})).on("wheel",((e,t,i)=>{this.updateScroll(.3*-i)}))}updateScroll(e){const t=this.container.y+e;t<-this.minus_y&&t>-this.max_y?this.container.y=t:t>-(this.max_y-this.minus_y)?this.container.y=-this.minus_y:t<-this.minus_y&&(this.container.y=-this.max_y),this.emit("scrollProgress",this.getScrollProgress())}get_max_y(){const e=[],t=(i,s=[])=>{i.list.forEach((i=>{if(i instanceof a().GameObjects.Container)s.push(i),t(i,s);else{const t=i;e.push(t.y+1.5*t.getBounds().height+s.reduce(((e,t)=>e+t.y),0))}}))};return t(this),Math.max(...e)}get_childs(){const e=[],t=i=>{i.list.forEach((i=>{"Container"===i.type?i instanceof a().GameObjects.Container&&t(i):e.push(i)}))};return t(this),e}get_last(){const e=this.get_childs();return e[e.map((e=>e.y)).indexOf(Math.max(...e.map((e=>e.y))))]}get_min_max_coords(){const e=this.get_childs(),t=e[e.map((e=>e.y)).indexOf(Math.min(...e.map((e=>e.y))))],i=e[e.map((e=>e.y)).indexOf(Math.max(...e.map((e=>e.y))))];return{min:t.y-t.getBounds().height/2,max:i.y+i.getBounds().height/2}}setXY(e,t,i,s){this.x=e,this.y=t,this.rect_mask=new(a().GameObjects.Rectangle)(this.scene,i||e,s||t,this.background.width,this.background.height,0,1),this.temp_mask=this.rect_mask.createGeometryMask(),this.container.mask=this.temp_mask,this.container.setPosition(-this.minus_x,-this.minus_y)}add_child(e,t){this.container.add(e),this.max_y=this.get_max_y()+(t||20)}replace_child(e,t){this.container.replace(e,t),this.max_y=this.get_max_y()+20}getScrollProgress(){const e=-this.minus_y,t=-this.max_y;return(this.container.y-t)/(e-t)}}class C extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_folders_buttons(),this.create_avatar_page(),this.create_frame_page(),this.create_feet_page(),this.create_flag_page(),this.create_background_page(),this.update_visible_page("avatar")}create_folders_buttons(){const e=x.cell_width;let t;const i=new(a().GameObjects.Image)(this.scene,4.5*e,3.5*e,"new","plank");i.setScale(.37,1),this.add(i),t=new S(this.scene,{x:4.5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"avatar"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("avatar"))}}),this.add(t),t=new S(this.scene,{x:9.6*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"frame"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("frame"))}}),this.add(t),t=new S(this.scene,{x:14.7*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"feet"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("feet"))}}),this.add(t),t=new S(this.scene,{x:19.8*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"flag"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("flag"))}}),this.add(t),t=new S(this.scene,{x:25*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"background"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("background"))}}),this.add(t)}update_visible_page(e){const t={avatar:this.avatar_page,frame:this.frame_page,feet:this.feet_page,flag:this.flag_page,background:this.background_page};this.page_moving=!0,this.current_page?this.scene.tweens.add({targets:this.current_page,alpha:0,duration:150,onComplete:()=>{this.current_page.visible=!1,this.page_name=e,this.current_page=t[this.page_name],this.current_page.visible=!0,this.scene.tweens.add({targets:this.current_page,alpha:1,duration:150,onComplete:()=>{this.page_moving=!1}})}}):(this.page_name=e,this.current_page=t[this.page_name],this.current_page.visible=!0,this.scene.tweens.add({targets:this.current_page,alpha:1,duration:200,onComplete:()=>{this.page_moving=!1}}))}create_avatar_page(){const e=x.cell_width;this.avatar_page=new(a().GameObjects.Container)(this.scene),this.avatar_page.alpha=0,this.avatar_page.visible=!1,this.add(this.avatar_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),t.lineBetween(y.width/2,5*e,y.width/2,16*e),t.lineBetween(y.width/2-e,5.5*e,y.width/2-e,15.5*e),t.lineBetween(26.5*e,5.5*e,26.5*e,15.5*e),this.avatar_page.add(t),i=new(a().GameObjects.Text)(this.scene,y.width/4,4.5*e,"YOU AVATARS",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,.75*y.width,4.5*e,"AVATARS",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,4.5*e,3.5*e,"AVATAR",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,9.6*e,3.5*e,"FRAME",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,14.7*e,3.5*e,"FEET",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,19.8*e,3.5*e,"FLAG",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"BATTLEFIELD",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.avatar_page.add(i);const s=new z(this.scene,{width:11*e,height:11*e});this.avatar_page.add(s),s.setXY(y.width/4,y.height/2+2.5*e);const n=new(a().GameObjects.Image)(this.scene,y.width/2-e,5.5*e,"new","scroller");this.avatar_page.add(n),s.on("scrollProgress",(t=>{n.y=5.5*e+10*(1-t)*e}));const o=x.user_data.personalization.avatars;let h;o.forEach(((t,i)=>{const n=i%2==0?8*e:3*e,o=i%2==0?2.8*e*(i-1):2.8*e*i;h=new(a().GameObjects.Image)(this.scene,n,o,"new","profile_ava"),s.add_child(h),h.y-=1.4*e,h.setInteractive(),h.on("pointerdown",(()=>{s.pointer_down=!0})),h.on("pointerup",(()=>{s.was_move?s.was_move=!1:this.handler_choose_ava(t),s.pointer_down=!1})),h.on("pointerout",(()=>{s.pointer_down=!1,s.was_move=!1})),h.on("pointermove",(e=>{s.emit("pointermove",e)})),h=new(a().GameObjects.Image)(this.scene,n,o+h.height/2,"new","blue_button"),s.add_child(h),h.scale=.8,h.y-=1*e,h.setInteractive(),h.on("pointerdown",(()=>{s.pointer_down=!0})),h.on("pointerup",(()=>{s.was_move?s.was_move=!1:this.handler_choose_ava("flag"),s.pointer_down=!1})),h.on("pointerout",(()=>{s.pointer_down=!1,s.was_move=!1})),h.on("pointermove",(e=>{s.emit("pointermove",e)}))}));const r=new z(this.scene,{width:11*e,height:11*e});this.avatar_page.add(r),r.setXY(20*e,y.height/2+2.5*e);const l=new(a().GameObjects.Image)(this.scene,26.5*e,5.5*e,"new","scroller");this.avatar_page.add(l),r.on("scrollProgress",(t=>{l.y=5.5*e+10*(1-t)*e})),o.forEach(((t,i)=>{const s=i%2==0?8*e:3*e,n=i%2==0?2.8*e*(i-1):2.8*e*i;h=new(a().GameObjects.Image)(this.scene,s,n,"new","profile_ava"),r.add_child(h),h.y-=1.4*e,h.setInteractive(),h.on("pointerdown",(()=>{r.pointer_down=!0})),h.on("pointerup",(()=>{r.was_move&&(r.was_move=!1),r.pointer_down=!1})),h.on("pointerout",(()=>{r.pointer_down=!1,r.was_move=!1})),h.on("pointermove",(e=>{r.emit("pointermove",e)})),h=new(a().GameObjects.Image)(this.scene,s,n+h.height/2,"new","blue_button"),r.add_child(h),h.scale=.8,h.y-=1*e,h.setInteractive(),h.on("pointerdown",(()=>{r.pointer_down=!0})),h.on("pointerup",(()=>{r.was_move?r.was_move=!1:this.handler_choose_ava("flag"),r.pointer_down=!1})),h.on("pointerout",(()=>{r.pointer_down=!1,r.was_move=!1})),h.on("pointermove",(e=>{r.emit("pointermove",e)}))}))}handler_choose_ava(e){console.log(e)}create_frame_page(){const e=x.cell_width;this.frame_page=new(a().GameObjects.Container)(this.scene),this.frame_page.alpha=0,this.frame_page.visible=!1,this.add(this.frame_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),t.lineBetween(y.width/2,5*e,y.width/2,16*e),t.lineBetween(y.width/2-e,5.5*e,y.width/2-e,15.5*e),t.lineBetween(26.5*e,5.5*e,26.5*e,15.5*e),this.frame_page.add(t),i=new(a().GameObjects.Text)(this.scene,y.width/4,4.5*e,"YOU FRAMES",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,.75*y.width,4.5*e,"FRAMES",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,4.5*e,3.5*e,"AVATAR",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,9.6*e,3.5*e,"FRAME",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,14.7*e,3.5*e,"FEET",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,19.8*e,3.5*e,"FLAG",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"BATTLEFIELD",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.frame_page.add(i);const s=new z(this.scene,{width:11*e,height:11*e});this.frame_page.add(s),s.setXY(y.width/4,y.height/2+2.5*e);const n=new(a().GameObjects.Image)(this.scene,y.width/2-e,5.5*e,"new","scroller");this.frame_page.add(n),s.on("scrollProgress",(t=>{n.y=5.5*e+10*(1-t)*e}));const o=x.user_data.personalization.avatars;let h;o.forEach(((t,i)=>{const n=i%2==0?8*e:3*e,o=i%2==0?2.8*e*(i-1):2.8*e*i;h=new(a().GameObjects.Image)(this.scene,n,o,"new","profile_ava"),s.add_child(h),h.y-=1.4*e,h.setInteractive(),h.on("pointerdown",(()=>{s.pointer_down=!0})),h.on("pointerup",(()=>{s.was_move?s.was_move=!1:this.handler_choose_ava(t),s.pointer_down=!1})),h.on("pointerout",(()=>{s.pointer_down=!1,s.was_move=!1})),h.on("pointermove",(e=>{s.emit("pointermove",e)}))}));const r=new z(this.scene,{width:11*e,height:11*e});this.frame_page.add(r),r.setXY(20*e,y.height/2+2.5*e);const l=new(a().GameObjects.Image)(this.scene,26.5*e,5.5*e,"new","scroller");this.frame_page.add(l),r.on("scrollProgress",(t=>{l.y=5.5*e+10*(1-t)*e})),o.forEach(((t,i)=>{const s=i%2==0?8*e:3*e,n=i%2==0?2.8*e*(i-1):2.8*e*i;h=new(a().GameObjects.Image)(this.scene,s,n,"new","profile_ava"),r.add_child(h),h.y-=1.4*e,h.setInteractive(),h.on("pointerdown",(()=>{r.pointer_down=!0})),h.on("pointerup",(()=>{r.was_move?r.was_move=!1:this.handler_choose_ava(t),r.pointer_down=!1})),h.on("pointerout",(()=>{r.pointer_down=!1,r.was_move=!1})),h.on("pointermove",(e=>{r.emit("pointermove",e)}))}))}create_feet_page(){const e=x.cell_width;this.feet_page=new(a().GameObjects.Container)(this.scene),this.feet_page.alpha=0,this.feet_page.visible=!1,this.add(this.feet_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),this.feet_page.add(t),i=new(a().GameObjects.Text)(this.scene,y.width/2,4.5*e,"CHOISE FEET!",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.feet_page.add(i),i=new(a().GameObjects.Text)(this.scene,4.5*e,3.5*e,"AVATAR",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.feet_page.add(i),i=new(a().GameObjects.Text)(this.scene,9.6*e,3.5*e,"FRAME",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.feet_page.add(i),i=new(a().GameObjects.Text)(this.scene,14.7*e,3.5*e,"FEET",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.feet_page.add(i),i=new(a().GameObjects.Text)(this.scene,19.8*e,3.5*e,"FLAG",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.feet_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"BATTLEFIELD",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.feet_page.add(i)}handler_choose_flag(e){let t=!1;return G.change_flag(e).then((e=>{var i;console.log(e),(null===(i=null==e?void 0:e.response)||void 0===i?void 0:i.flag)&&(x.user_data.flag=e.response.flag,k.game_play.game_play.update_flag(),t=!0)})),t}create_flag_page(){const e=x.cell_width;this.flag_page=new(a().GameObjects.Container)(this.scene),this.flag_page.alpha=0,this.flag_page.visible=!1,this.add(this.flag_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),t.lineBetween(26.5*e,5.5*e,26.5*e,15.5*e),this.flag_page.add(t),i=new(a().GameObjects.Text)(this.scene,y.width/2,4.5*e,"CHOISE FLAG!",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.flag_page.add(i),i=new(a().GameObjects.Text)(this.scene,4.5*e,3.5*e,"AVATAR",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.flag_page.add(i),i=new(a().GameObjects.Text)(this.scene,9.6*e,3.5*e,"FRAME",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.flag_page.add(i),i=new(a().GameObjects.Text)(this.scene,14.7*e,3.5*e,"FEET",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.flag_page.add(i),i=new(a().GameObjects.Text)(this.scene,19.8*e,3.5*e,"FLAG",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.flag_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"BATTLEFIELD",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.flag_page.add(i);const s=new z(this.scene,{width:24*e,height:11*e});this.flag_page.add(s),s.setXY(y.width/2,y.height/2+2.5*e);const n=new(a().GameObjects.Image)(this.scene,26.5*e,5.5*e,"new","scroller");this.flag_page.add(n),s.on("scrollProgress",(t=>{n.y=5.5*e+10*(1-t)*e}));const o={};x.flags.forEach(((t,n)=>{const h=n%5*e*4.5+2*e,r=Math.floor(n/5)*e*5+1.5*e;let l=new(a().GameObjects.Image)(this.scene,h,r,"default_frame");s.add_child(l),l.setInteractive();const c=new(a().GameObjects.Image)(this.scene,h,r,"flags",t);c.setScale(.3),c.setName(t),s.add_child(c),l.on("pointerdown",(()=>{s.pointer_down=!0})),l.on("pointerup",(()=>{if(s.was_move)s.was_move=!1;else{const e=x.user_data.flag,t=c.name;e!==t&&this.handler_choose_flag(t)&&(o[e].text.visible=!0,o[e].setFrame("lightblue_button"),o[t].text.visible=!1,o[t].setFrame("blue_button"))}s.pointer_down=!1})),l.on("pointerout",(()=>{s.pointer_down=!1,s.was_move=!1})),l.on("pointermove",(e=>{s.emit("pointermove",e)})),l=new(a().GameObjects.Image)(this.scene,h,r+l.height/2+.4*e,"new",t!==x.user_data.flag?"lightblue_button":"blue_button"),l.scale=.8,l.setInteractive(),s.add_child(l),i=new(a().GameObjects.Text)(this.scene,l.x,l.y,"CHOOSE",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),s.add_child(i),i.visible=t!==x.user_data.flag,l.text=i,o[c.name]=l,l.on("pointerdown",(()=>{s.pointer_down=!0})),l.on("pointerup",(()=>{if(s.was_move)s.was_move=!1;else{const e=x.user_data.flag,t=c.name;e!==t&&this.handler_choose_flag(t)&&(o[e].text.visible=!0,o[e].setFrame("lightblue_button"),o[t].text.visible=!1,o[t].setFrame("blue_button"))}s.pointer_down=!1})),l.on("pointerout",(()=>{s.pointer_down=!1,s.was_move=!1})),l.on("pointermove",(e=>{s.emit("pointermove",e)}))}))}create_background_page(){const e=x.cell_width;this.background_page=new(a().GameObjects.Container)(this.scene),this.background_page.alpha=0,this.background_page.visible=!1,this.add(this.background_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),this.background_page.add(t),i=new(a().GameObjects.Text)(this.scene,y.width/2,4.5*e,"CHOISE BATTLEFIELD!",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),this.background_page.add(i),i=new(a().GameObjects.Text)(this.scene,4.5*e,3.5*e,"AVATAR",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.background_page.add(i),i=new(a().GameObjects.Text)(this.scene,9.6*e,3.5*e,"FRAME",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.background_page.add(i),i=new(a().GameObjects.Text)(this.scene,14.7*e,3.5*e,"FEET",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.background_page.add(i),i=new(a().GameObjects.Text)(this.scene,19.8*e,3.5*e,"FLAG",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.background_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"BATTLEFIELD",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.background_page.add(i)}show(){}handler_close(){}}class E extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_static_images(),this.create_texts(),this.create_volume_control(),this.create_fullscreen_control(),this.create_language_control(),this.create_privacy_policy()}show(){}create_static_images(){const e=x.cell_width,t=new(a().GameObjects.Graphics)(this.scene);t.lineStyle(7,335737,1),t.lineBetween(y.width/2-6*e,4.5*e,y.width/2+6*e,4.5*e),t.lineBetween(y.width/2-6*e,6.5*e,y.width/2+6*e,6.5*e),this.add(t)}create_texts(){const e=x.cell_width;let t;t=new(a().GameObjects.Text)(this.scene,y.width/2,3.5*e,"MUSIC",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,y.width/2,5.5*e,"EFFECT AND VOICE",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,y.width/2,7.5*e,"SCREEN MODE",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,y.width/2,9.5*e,"LANGUAGE",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),this.add(t)}create_language_control(){const e=x.cell_width;let t;const i=new(a().GameObjects.Image)(this.scene,y.width/2,10.5*e,"new","flag_micro");i.scale=1.3,this.add(i);const s=new(a().GameObjects.Text)(this.scene,y.width/2,11.5*e,"УКРАЇНСЬКА",{fontFamily:"rubik",fontSize:28,color:"#051F79"});s.setOrigin(.5),this.add(s),t=new S(this.scene,{x:y.width/2-3.5*e,y:11.5*e,atlas:"game_play",frame_out:"back_icon",callback:()=>{}}),this.add(t),t=new S(this.scene,{x:y.width/2+3.5*e,y:11.5*e,atlas:"game_play",frame_out:"back_icon",callback:()=>{}}),t.out_img.setFlipX(!0),this.add(t)}create_volume_control(){const e=x.cell_width,t=new(a().GameObjects.Image)(this.scene,y.width/2-6*e,4.55*e,"new","scroller");this.add(t),t.setInteractive({draggable:!0}),t.on("drag",((i,s)=>{s>y.width/2-6*e&&s<y.width/2+6*e&&(t.x=s)})),t.on("dragend",(()=>{}));const i=new(a().GameObjects.Image)(this.scene,y.width/2-6*e,6.55*e,"new","scroller");this.add(i)}create_fullscreen_control(){const e=x.cell_width;let t,i;i=new S(this.scene,{x:y.width/2-3.5*e,y:8.5*e,atlas:"new",frame_out:"plank_frame",callback:()=>{this.handler_privacy_policy()}}),i.out_img.scaleX=1.25,t=new(a().GameObjects.Text)(this.scene,0,0,"WINDOW",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),i.add(t),this.add(i),i=new S(this.scene,{x:y.width/2+3.5*e,y:8.5*e,atlas:"new",frame_out:"plank_frame",callback:()=>{this.handler_privacy_policy()}}),i.out_img.scaleX=1.25,t=new(a().GameObjects.Text)(this.scene,0,0,"FULLSCREEN",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),t.setOrigin(.5),i.add(t),this.add(i)}create_privacy_policy(){const e=x.cell_width,t=new S(this.scene,{x:y.width/2,y:13.5*e,atlas:"new",frame_out:"plank_frame",callback:()=>{this.handler_privacy_policy()}});t.out_img.scaleX=1.5;const i=new(a().GameObjects.Text)(this.scene,0,0,"PRIVACY POLICY",{fontFamily:"rubik",fontSize:28,color:"#051F79"});i.setOrigin(.5),t.add(i),this.add(t)}handler_privacy_policy(){}handler_close(){}}class R extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_folders_buttons(),this.create_rating_slider()}create_folders_buttons(){const e=x.cell_width;let t,i;const s=new(a().GameObjects.Image)(this.scene,11.5*e,3.5*e,"new","plank");s.setScale(.6475,1),this.add(s);const n=new(a().GameObjects.Image)(this.scene,4.5*e,5.5*e,"new","plank");n.setScale(.4625,1),this.add(n),this.page_moving=!1;const o=[],h=[];i=new S(this.scene,{x:11.5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"avatar"==this.page_name||this.page_moving||(s.setScale(.37*e.scaleX,e.scaleY),s.setPosition(e.x,e.y),o.forEach((e=>e.setStyle({color:"#051F79"}))),o[0].setStyle({color:"#FFFFFF"}))}}),i.setScale(1.75,1),t=new(a().GameObjects.Text)(this.scene,i.x,i.y,"ONLINE MODE",{fontFamily:"rubik",fontSize:28,color:"#FFFFFF"}),o.push(t),t.setOrigin(.5),this.add(t),this.add(i),i=new S(this.scene,{x:20.5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"frame"==this.page_name||this.page_moving||(s.setScale(.37*e.scaleX,e.scaleY),s.setPosition(e.x,e.y),o.forEach((e=>e.setStyle({color:"#051F79"}))),o[1].setStyle({color:"#FFFFFF"}))}}),i.setScale(1.75,1),t=new(a().GameObjects.Text)(this.scene,i.x,i.y,"SINGLE MODE",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),o.push(t),t.setOrigin(.5),this.add(t),this.add(i),i=new S(this.scene,{x:4.5*e,y:5.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"feet"==this.page_name||this.page_moving||(n.setScale(.37*e.scaleX,e.scaleY),n.setPosition(e.x,e.y),h.forEach((e=>e.setStyle({color:"#051F79"}))),h[0].setStyle({color:"#FFFFFF"}))}}),i.setScale(1.25,1),t=new(a().GameObjects.Text)(this.scene,i.x,i.y,"PER DAY",{fontFamily:"rubik",fontSize:28,color:"#FFFFFF"}),h.push(t),t.setOrigin(.5),this.add(t),this.add(i),i=new S(this.scene,{x:4.5*e,y:7.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"flag"==this.page_name||this.page_moving||(n.setScale(.37*e.scaleX,e.scaleY),n.setPosition(e.x,e.y),h.forEach((e=>e.setStyle({color:"#051F79"}))),h[1].setStyle({color:"#FFFFFF"}))}}),i.setScale(1.25,1),t=new(a().GameObjects.Text)(this.scene,i.x,i.y,"IN A WEEK",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),h.push(t),t.setOrigin(.5),this.add(t),this.add(i),i=new S(this.scene,{x:4.5*e,y:9.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"background"==this.page_name||this.page_moving||(n.setScale(.37*e.scaleX,e.scaleY),n.setPosition(e.x,e.y),h.forEach((e=>e.setStyle({color:"#051F79"}))),h[2].setStyle({color:"#FFFFFF"}))}}),i.setScale(1.25,1),t=new(a().GameObjects.Text)(this.scene,i.x,i.y,"FOR ALL TIME",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),h.push(t),t.setOrigin(.5),this.add(t),this.add(i)}create_rating_slider(){const e=x.cell_width,t=new z(this.scene,{width:18*e,height:10*e});this.add(t),t.setXY(16*e,10*e);const i=new(a().GameObjects.Image)(this.scene,y.width-2.1*e,5*e,"new","scroller");let s;this.add(i),t.on("scrollProgress",(t=>{i.y=5.5*e+10*(1-t)*e}));const n=8.6*e;let o;[{},{},{},{},{},{}].forEach(((i,h)=>{o=h*e,s=new(a().GameObjects.Rectangle)(this.scene,n,o+.5*e,18*e,7,335737),t.add_child(s)}))}show(){}handler_close(){}}class A extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_folders_buttons(),this.create_free_page(),this.create_coins_page(),this.create_gems_page(),this.create_promotion_page(),this.update_visible_page("free")}create_folders_buttons(){const e=x.cell_width;let t;const i=new(a().GameObjects.Image)(this.scene,5*e,3.5*e,"new","plank");i.setScale(5/11,1),this.add(i),t=new S(this.scene,{x:5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"avatar"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("free"))}}),t.setScale(1.2,1),this.add(t),t=new S(this.scene,{x:11.5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"frame"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("coins"))}}),t.setScale(1.2,1),this.add(t),t=new S(this.scene,{x:18.5*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"feet"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("gems"))}}),t.setScale(1.2,1),this.add(t),t=new S(this.scene,{x:25*e,y:3.5*e,atlas:"new",frame_out:"plank_frame",callback:e=>{"flag"==this.page_name||this.page_moving||(i.setPosition(e.x,e.y),this.update_visible_page("promotion"))}}),t.setScale(1.2,1),this.add(t)}update_visible_page(e){const t={free:this.free_page,coins:this.coins_page,gems:this.gems_page,promotion:this.promotion_page};this.page_moving=!0,this.current_page?this.scene.tweens.add({targets:this.current_page,alpha:0,duration:150,onComplete:()=>{this.current_page.visible=!1,this.page_name=e,this.current_page=t[this.page_name],this.current_page.visible=!0,this.scene.tweens.add({targets:this.current_page,alpha:1,duration:150,onComplete:()=>{this.page_moving=!1}})}}):(this.page_name=e,this.current_page=t[this.page_name],this.current_page.visible=!0,this.scene.tweens.add({targets:this.current_page,alpha:1,duration:200,onComplete:()=>{this.page_moving=!1}}))}create_free_page(){const e=x.cell_width;this.free_page=new(a().GameObjects.Container)(this.scene),this.free_page.alpha=0,this.free_page.visible=!1,this.add(this.free_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),this.free_page.add(t),i=new(a().GameObjects.Text)(this.scene,5*e,3.5*e,"FREE",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.free_page.add(i),i=new(a().GameObjects.Text)(this.scene,11.5*e,3.5*e,"COINS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.free_page.add(i),i=new(a().GameObjects.Text)(this.scene,18.5*e,3.5*e,"GEMS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.free_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"PROMOTIONS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.free_page.add(i)}handler_choose_ava(){}create_coins_page(){const e=x.cell_width;this.coins_page=new(a().GameObjects.Container)(this.scene),this.coins_page.alpha=0,this.coins_page.visible=!1,this.add(this.coins_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),this.coins_page.add(t),i=new(a().GameObjects.Text)(this.scene,5*e,3.5*e,"FREE",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.coins_page.add(i),i=new(a().GameObjects.Text)(this.scene,11.5*e,3.5*e,"COINS",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.coins_page.add(i),i=new(a().GameObjects.Text)(this.scene,18.5*e,3.5*e,"GEMS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.coins_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"PROMOTIONS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.coins_page.add(i);const s=new(a().GameObjects.Container)(this.scene);this.coins_page.add(s);let n=0;x.shop.purchase_items.forEach((t=>{if("coins"===t.type){let i,o;const h=new(a().GameObjects.Container)(this.scene,4*e+n*e*7,8.5*e),r=new(a().GameObjects.Graphics)(this.scene);r.lineStyle(6,467577,1),r.strokeRect(-3*e+3,-2.5*e+3,6*e-3,6*e-3),h.add(r),i=new(a().GameObjects.Image)(this.scene,1,-3*e,"new","plank"),i.setScale(6/11+.015,1),h.add(i),o=new(a().GameObjects.Text)(this.scene,1,-3*e,"COINS PACK",{fontFamily:"rubik",fontSize:28}),o.setOrigin(.5),h.add(o),i=new(a().GameObjects.Image)(this.scene,0,-.5*e,"shop",t.icon),i.height>3*e&&i.setScale(3*e/i.height),h.add(i),i=new(a().GameObjects.Image)(this.scene,1,2*e,"new","plank"),i.setScale(4/11,1),h.add(i),o=new(a().GameObjects.Text)(this.scene,1,2*e,String(t.items.money),{fontFamily:"rubik",fontSize:36}),o.setOrigin(.5),h.add(o),i=new(a().GameObjects.Image)(this.scene,0,4*e,"new","purple_button"),h.add(i),i.setInteractive(),i.on("pointerup",(()=>{})),o=new(a().GameObjects.Text)(this.scene,0,4*e,String(t.price),{fontFamily:"rubik",fontSize:36}),o.setOrigin(.5),h.add(o),s.add(h),n++}}))}create_gems_page(){const e=x.cell_width;this.gems_page=new(a().GameObjects.Container)(this.scene),this.gems_page.alpha=0,this.gems_page.visible=!1,this.add(this.gems_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),this.gems_page.add(t),i=new(a().GameObjects.Text)(this.scene,5*e,3.5*e,"FREE",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.gems_page.add(i),i=new(a().GameObjects.Text)(this.scene,11.5*e,3.5*e,"COINS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.gems_page.add(i),i=new(a().GameObjects.Text)(this.scene,18.5*e,3.5*e,"GEMS",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.gems_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"PROMOTIONS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.gems_page.add(i);const s=new(a().GameObjects.Container)(this.scene);this.gems_page.add(s);let n=0;x.shop.purchase_items.forEach((t=>{if("gems"===t.type){let i,o;const h=new(a().GameObjects.Container)(this.scene,4*e+n*e*7,8.5*e),r=new(a().GameObjects.Graphics)(this.scene);r.lineStyle(6,467577,1),r.strokeRect(-3*e+3,-2.5*e+3,6*e-3,6*e-3),h.add(r),i=new(a().GameObjects.Image)(this.scene,1,-3*e,"new","plank"),i.setScale(6/11+.015,1),h.add(i),o=new(a().GameObjects.Text)(this.scene,1,-3*e,"COINS PACK",{fontFamily:"rubik",fontSize:28}),o.setOrigin(.5),h.add(o),i=new(a().GameObjects.Image)(this.scene,0,-.5*e,"shop",t.icon),i.height>3*e&&i.setScale(3*e/i.height),h.add(i),i=new(a().GameObjects.Image)(this.scene,1,2*e,"new","plank"),i.setScale(4/11,1),h.add(i),o=new(a().GameObjects.Text)(this.scene,1,2*e,String(t.items.gems),{fontFamily:"rubik",fontSize:36}),o.setOrigin(.5),h.add(o),i=new(a().GameObjects.Image)(this.scene,0,4*e,"new","purple_button"),h.add(i),i.setInteractive(),i.on("pointerup",(()=>{})),o=new(a().GameObjects.Text)(this.scene,0,4*e,String(t.price),{fontFamily:"rubik",fontSize:36}),o.setOrigin(.5),h.add(o),s.add(h),n++}}))}create_promotion_page(){const e=x.cell_width;this.promotion_page=new(a().GameObjects.Container)(this.scene),this.promotion_page.alpha=0,this.promotion_page.visible=!1,this.add(this.promotion_page);const t=new(a().GameObjects.Graphics)(this.scene);let i;t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),this.promotion_page.add(t),i=new(a().GameObjects.Text)(this.scene,5*e,3.5*e,"FREE",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.promotion_page.add(i),i=new(a().GameObjects.Text)(this.scene,11.5*e,3.5*e,"COINS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.promotion_page.add(i),i=new(a().GameObjects.Text)(this.scene,18.5*e,3.5*e,"GEMS",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.promotion_page.add(i),i=new(a().GameObjects.Text)(this.scene,25*e,3.5*e,"PROMOTIONS",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"}),i.setOrigin(.5),this.promotion_page.add(i)}show(){}handler_close(){}}class M extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_folders_buttons(),this.create_flag_page()}create_folders_buttons(){const e=x.cell_width,t=new(a().GameObjects.Image)(this.scene,y.width/2,3.5*e,"new","plank");t.setScale(2.8,1),this.add(t);const i=new(a().GameObjects.Text)(this.scene,y.width/2,3.5*e,"ACHIVMENTS",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"});i.setOrigin(.5),this.add(i)}create_flag_page(){const e=x.cell_width;this.flag_page=new(a().GameObjects.Container)(this.scene),this.add(this.flag_page);const t=new(a().GameObjects.Graphics)(this.scene);t.lineStyle(7,335737,1),t.lineBetween(0,5*e,y.width,5*e),t.lineBetween(26.5*e,5.5*e,26.5*e,15.5*e),this.flag_page.add(t);const i=new z(this.scene,{width:24*e,height:11*e});this.flag_page.add(i),i.setXY(y.width/2,y.height/2+2.5*e);const s=new(a().GameObjects.Image)(this.scene,26.5*e,5.5*e,"new","scroller");let o;this.flag_page.add(s),i.on("scrollProgress",(t=>{s.y=5.5*e+10*(1-t)*e}));for(let t=0;t<16;t++){const s=t%4*e*5.5+2*e,h=Math.floor(t/4)*e*9+4*e;o=new(a().GameObjects.Rectangle)(this.scene,s,h,5*e,8*e,0,0),o.setStrokeStyle(5,335737,1),i.add_child(o),o=new(a().GameObjects.Image)(this.scene,s,h-3.5*e,"new","plank"),o.setScale(.46,1),i.add_child(o),o=new(a().GameObjects.Image)(this.scene,s,h-.5*e,"medal"),i.add_child(o),o=new n(this.scene,{atlas:"new",frame_bg:"plank",frame_bar:"oil_progress"}),o.bg.setScale(.73,1),o.update_progress(Math.random()),o.setPosition(s,h+3*e),o.setScale(.55,1),i.add_child(o),o=new(a().GameObjects.Text)(this.scene,s,h-3.5*e,"ACHIVMENT NAME",{fontFamily:"rubik",fontSize:28,color:"#FFFFFF"}),o.setOrigin(.5),i.add_child(o),o=new(a().GameObjects.Text)(this.scene,s,h+1.7*e,"Sink single-deck ships\nwithout failures",{fontFamily:"rubik",fontSize:24,color:"#051F79",align:"center"}),o.setOrigin(.5),i.add_child(o)}}show(){}handler_close(){}}class B extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.create_main_prize(),this.create_rating_slider()}create_main_prize(){const e=x.cell_width+2,t=new(a().GameObjects.Rectangle)(this.scene,261,y.height/2+100,5*e,9*e);t.setStrokeStyle(5,467577,1),this.add(t);const i=new(a().GameObjects.Image)(this.scene,261,y.height/2-50,"game_play","chest_closed");i.setScale(1.5),this.add(i);let s=new(a().GameObjects.Text)(this.scene,261,y.height/2-250,"ADMIRAL REWARD",{fontFamily:"rubik",fontSize:32,color:"#051F79"});s.setOrigin(.5),this.add(s),s=new(a().GameObjects.Text)(this.scene,261,y.height/2+118,"Log in every day and\nwin a special prize!",{fontFamily:"rubik",fontSize:28,color:"#051F79",align:"center"}),s.setOrigin(.5),this.add(s),this.create_day_bar()}create_day_bar(){const e=x.cell_width;this.day_bar=new n(this.scene,{atlas:"new",frame_bg:"plank",frame_bar:"oil_progress"}),this.day_bar.bg.setScale(.73,1),this.day_bar.update_progress((x.user_data.daily_reward.amount+1)/x.daily_rewards.length),this.day_bar.setPosition(261,y.height/2+100+2.7*e),this.day_bar.setScale(.6,.9),this.add(this.day_bar),this.day_bar_txt=new(a().GameObjects.Text)(this.scene,261,y.height/2+100+1.7*e,`DAY ${x.user_data.daily_reward.amount+1}/${x.daily_rewards.length}`,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),this.day_bar_txt.setOrigin(.5,.5),this.add(this.day_bar_txt)}create_rating_slider(){const e=x.cell_width,t=new z(this.scene,{width:18*e,height:10*e});this.add(t),t.setXY(16*e,10*e);const i=new(a().GameObjects.Image)(this.scene,y.width-2.1*e,5*e,"new","scroller");let s;this.add(i),t.on("scrollProgress",(t=>{i.y=5.5*e+10*(1-t)*e}));const o=8.6*e;let h;s=new(a().GameObjects.Image)(this.scene,16.5*e,3.5*e,"new","plank"),s.setScale(1.59,1),this.add(s);for(let i=0;i<10;i++)h=1*e+2.3*i*e,s=new(a().GameObjects.Image)(this.scene,1.3*e,h,"temp_task_reward"),t.add_child(s),s=new(a().GameObjects.Rectangle)(this.scene,o+.3*e,h,17*e,2*e,335737,0),s.setStrokeStyle(5,335737,1),t.add_child(s),s=new(a().GameObjects.Text)(this.scene,3*e,h-20,"TASK NAME",{fontFamily:"rubik",fontSize:28,color:"#051F79"}),s.setOrigin(0,.5),t.add_child(s),s=new n(this.scene,{atlas:"new",frame_bg:"plank",frame_bar:"oil_progress"}),s.bg.setScale(.73,1),s.update_progress(Math.random()),s.setPosition(o-.7*e,h+30),s.setScale(1.3,.7),t.add_child(s),s=new(a().GameObjects.Image)(this.scene,o+440,h,"new","blue_button"),s.setScale(.8),t.add_child(s)}show(){}handler_close(){}}class P extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.cell_width=x.cell_width,this.create_back(),this.create_interface(),this.create_scenes()}create_back(){this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(0,0,y.width,y.height),this.add(this.bg);const e=Math.ceil(y.height/this.cell_width),t=Math.ceil(y.width/this.cell_width);this.bg.lineStyle(2,6386084,.7);for(let t=0;t<=e;t++)this.bg.lineBetween(0,t*this.cell_width,y.width,t*this.cell_width);for(let e=0;e<=t;e++)this.bg.lineBetween(e*this.cell_width,0,e*this.cell_width,y.height);this.bg.lineStyle(7,13582392,.9),this.bg.lineBetween(0,3*this.cell_width,y.width,3*this.cell_width)}create_scenes(){this.profile=new I(this.scene),this.personalization=new C(this.scene),this.settings=new E(this.scene),this.leaderboard=new R(this.scene),this.shop=new A(this.scene),this.achivments=new M(this.scene),this.tasks=new B(this.scene),this.add([this.profile,this.personalization,this.settings,this.leaderboard,this.shop,this.achivments,this.tasks]),this.update_scenes("profile",!0)}update_scenes(e,t){const i={profile:this.profile,personalization:this.personalization,settings:this.settings,leaderboard:this.leaderboard,shop:this.shop,achivments:this.achivments,tasks:this.tasks};let s=!1;Object.keys(i).forEach((a=>{s=a===e,i[a]&&(i[a].visible=s),s?i[a].show():!t&&i[a].visible?(this.bringToTop(i[a]),k.anims_manager.get_big_window_move_anim(i[a],(()=>{i[a].handler_close()}))):i[a].visible&&i[a].handler_close()}))}create_interface(){this.home_button=new S(this.scene,{x:6.5*this.cell_width,y:1.5*this.cell_width,atlas:"new",frame_out:"plank",callback:()=>{k.update_scenes("game_menu")}}),this.home_button.out_img.setScale(.65,1);const e=new(a().GameObjects.Image)(this.scene,-4*this.cell_width,0,"game_play","back_icon");e.setInteractive(),e.on("pointerup",(()=>{k.update_scenes("game_menu")})),this.home_button.add(e);const t=new(a().GameObjects.Text)(this.scene,0,0,"MAIN MENU",{fontFamily:"rubik",fontSize:36});t.setOrigin(.5),this.home_button.add(t),this.add(this.home_button)}}class D extends a().GameObjects.Container{constructor(e,t){super(e),this.init(t)}init(e){const{atlas:t,broke_frame:i,live_frame:s}=e;this.x=e.pos.x,this.y=e.pos.y,e.scale&&(this.scale=e.scale),this.broke_image=new(a().GameObjects.Image)(this.scene,0,0,t||i,t?i:void 0),this.live_image=new(a().GameObjects.Image)(this.scene,0,0,t||s,t?s:void 0),this.add([this.broke_image,this.live_image]),this.state_live=!1,this.update_living()}update_living(){this.broke_image.visible=!this.state_live,this.live_image.visible=this.state_live}}class L extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.zoom=0,this.create_roads(),this.init_interactive()}init_interactive(){this.interactive_shape=new(a().GameObjects.Rectangle)(this.scene,0,0,y.width,y.height),this.setInteractive(this.interactive_shape,a().Geom.Rectangle.Contains),this.scene.input.addPointer(1),this.scene.input.on("wheel",((e,t,i,s)=>{this.active_map&&this.update_zoom(e,-s)})),this.bg.setInteractive({draggable:!0}),this.bg.on("drag",((e,t,i)=>{this.active_map&&this.update_drag(t,i)}))}update(){if(this.scene.input.pointer1&&this.scene.input.pointer1.isDown&&this.scene.input.pointer2&&this.scene.input.pointer2.isDown){this.prev_pos1||(this.prev_pos1={x:this.scene.input.pointer1.x,y:this.scene.input.pointer1.y}),this.prev_pos2||(this.prev_pos2={x:this.scene.input.pointer2.x,y:this.scene.input.pointer2.y});const e=this.scene.input.pointer1,t=this.scene.input.pointer2;this.update_zoom({x:(e.x+t.x)/2,y:(e.y+t.y)/2},3*(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))-Math.sqrt(Math.pow(this.prev_pos2.x-this.prev_pos1.x,2)+Math.pow(this.prev_pos2.y-this.prev_pos1.y,2))))}}update_drag(e,t){e>y.width&&(e=y.width),e<0&&(e=0),t>y.height&&(t=y.height),t<0&&(t=0),this.bg.setPosition(e,t)}update_zoom(e,t){const i=this.zoom+t/10;i>=10&&i<=100&&(this.zoom=i,this.scene.tweens.add({targets:this,x:-e.x*this.zoom/100,y:-e.y*this.zoom/100,scale:this.zoom/100+1,duration:100}))}create_roads(){this.bg=new(a().GameObjects.Image)(this.scene,y.width/2,y.height/2,"main_bg"),this.bg.setScale(.66),this.add(this.bg)}create_items(){const e=this.scene.cache.json.get("map_items");let t;console.log(e),e.forEach((e=>{t=new D(this.scene,e),this.add(t)}))}}class N extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.hover_interface=[],this.bg=new(a().GameObjects.Image)(this.scene,y.width/2,y.height/2,"page_bg"),this.bg.setScale(y.height/this.bg.height),this.add(this.bg),this.create_game_map(),this.darker=new(a().GameObjects.Image)(this.scene,0,0,"darkner"),this.darker.setOrigin(0),this.darker.setScale(y.width/this.darker.width,y.height/this.darker.height),this.add(this.darker),this.create_interface(),this.crreate_balance_planks()}crreate_balance_planks(){let e=new(a().GameObjects.Image)(this.scene,y.width/2+150,70,"game_menu","mini_back");this.add(e),e=new(a().GameObjects.Image)(this.scene,e.x-e.width/2+20,70,"game_menu","coin"),this.add(e),e=new(a().GameObjects.Image)(this.scene,y.width/2+550,70,"game_menu","mini_back"),this.add(e),e=new(a().GameObjects.Image)(this.scene,e.x-e.width/2+20,70,"game_menu","gem"),this.add(e),this.money_txt=new(a().GameObjects.Text)(this.scene,y.width/2+150,70,x.user_data.coins.toString(),{fontFamily:"rubik",fontSize:36,color:"#3C2415"}),this.money_txt.setOrigin(.5),this.add(this.money_txt),this.gems_txt=new(a().GameObjects.Text)(this.scene,y.width/2+550,70,x.user_data.gems.toString(),{fontFamily:"rubik",fontSize:36,color:"#3C2415"}),this.gems_txt.setOrigin(.5),this.add(this.gems_txt)}create_game_map(){this.game_map=new L(this.scene),this.add(this.game_map)}update_name(){const e=x.user_data.name;this.profile_name.text=e}create_interface(){this.profile_container=new(a().GameObjects.Container)(this.scene,100,120),this.add(this.profile_container),this.hover_interface.push(this.profile_container),this.ava_frame=new(a().GameObjects.Image)(this.scene,20,20,"ava_frame"),this.ava=new(a().GameObjects.Image)(this.scene,this.ava_frame.x,this.ava_frame.y,"new","profile_ava"),this.profile_bg=new(a().GameObjects.Image)(this.scene,this.ava.x+this.ava.width/2,this.ava.y-this.ava.height/2,"game_menu","medium_back"),this.profile_bg.setInteractive(),this.profile_bg.on("pointerup",(()=>{k.big_windows.update_scenes("profile"),k.update_scenes("big_windows")})),this.profile_bg.setOrigin(0),this.profile_name=new(a().GameObjects.Text)(this.scene,this.profile_bg.x+this.profile_bg.width/2,this.profile_bg.y+50,"Player",{fontFamily:"rubik",fontSize:28,color:"#3C2415"}),this.profile_name.setOrigin(.5),this.update_name(),this.profile_container.add([this.ava_frame,this.profile_bg,this.ava,this.profile_name]),this.custom_button=new S(this.scene,{x:this.profile_bg.x+this.profile_container.x,y:0,atlas:"game_menu",frame_out:"little_back",callback:()=>{k.big_windows.update_scenes("personalization"),k.update_scenes("big_windows")}}),this.hover_interface.push(this.custom_button),this.custom_button.scale=1.1,this.custom_button.x+=this.profile_bg.width+this.custom_button.out_img.width/2+15,this.custom_button.y+=this.profile_bg.height/2-10,this.add(this.custom_button),this.settings_button=new S(this.scene,{x:y.width-20,y:this.profile_bg.y+this.profile_container.y,atlas:"game_menu",frame_out:"micro_back",callback:()=>{k.windows_manager.show_window("options")}}),this.hover_interface.push(this.settings_button),this.settings_button.setOrigin(1,0),this.add(this.settings_button),this.play_button=new S(this.scene,{x:y.width-20,y:y.height-20,atlas:"game_menu",frame_out:"big_back",callback:()=>{x.game_play.with_bot?k.windows_manager.show_window("arena_slider"):(k.game_play.update_scenes("prepare_field"),k.update_scenes("game_play"))}}),this.hover_interface.push(this.play_button),this.play_button.setOrigin(1),this.add(this.play_button);let e=new(a().GameObjects.Image)(this.scene,-100,0,"game_menu","icon_play");this.play_button.add(e);const t=new(a().GameObjects.Text)(this.scene,50,0,"BATTLE",{fontFamily:"rubik",fontSize:48});t.setOrigin(.5),this.play_button.add(t),this.mode_button_container=new(a().GameObjects.Container)(this.scene,this.play_button.x-(this.play_button.out_img.width/2+20),this.play_button.y+this.play_button.out_img.height/2),this.hover_interface.push(this.mode_button_container),this.add(this.mode_button_container);const i=new(a().GameObjects.Text)(this.scene,-150,-120,"BOT GAME",{fontFamily:"rubik",fontSize:28,color:"#3C2415"});i.setOrigin(.5),this.mode_bg=new(a().GameObjects.Image)(this.scene,0,0,"game_menu","medium_back"),this.mode_bg.setOrigin(1),this.mode_bg.setInteractive(),this.mode_bg.on("pointerup",(()=>{"icon_bot"===this.mode_img.frame.name?(x.game_play.with_bot=!1,this.mode_img.setFrame("icon_friend"),this.mode_img.x=-240,i.text="FRIENDS GAME",i.setFontSize(22)):(x.game_play.with_bot=!0,this.mode_img.setFrame("icon_bot"),this.mode_img.x=-250,i.text="BOT GAME",i.setFontSize(28)),this.mode_img.setOrigin(1)})),this.mode_img=new(a().GameObjects.Image)(this.scene,-250,-50,"game_menu","icon_bot"),this.mode_img.setOrigin(1),this.mode_button_container.add([this.mode_bg,this.mode_img]);const s=new(a().GameObjects.Rectangle)(this.scene,-130,-70,180,40,3941397,1);this.mode_button_container.add(s),this.mode_button_container.add(i);const n=new(a().GameObjects.Text)(this.scene,-120,-70,"REWARD X2",{fontFamily:"rubik",fontSize:24,color:"#FFFFFF"});n.setOrigin(.5),this.mode_button_container.add(n),e=new(a().GameObjects.Image)(this.scene,-220,-70,"game_menu","coin"),e.setScale(.65),this.mode_button_container.add(e),this.create_buttons()}create_banner(){const e=new(a().GameObjects.Image)(this.scene,20,y.height-20,"game_menu","big_back");e.setOrigin(0,1),this.add(e);const t=new(a().GameObjects.Text)(this.scene,e.x+e.width/2,e.y-e.height/2,"BANNER",{fontFamily:"rubik",fontSize:48,color:"#051F79"});t.setOrigin(.5),this.add(t)}switch_interface(e){this.scene.tweens.add({targets:this.hover_interface,duration:200,alpha:e?0:1})}create_buttons(){const e=[{x:150,y:y.height/2},{x:150,y:y.height/2+200},{x:y.width-150,y:y.height/2-200},{x:y.width-150,y:y.height/2},{x:y.width-150,y:y.height/2+200}];let t,i,s;t=new S(this.scene,{x:e[0].x,y:e[0].y,atlas:"game_menu",frame_out:"basic_button",callback:()=>{k.big_windows.update_scenes("leaderboard"),k.update_scenes("big_windows")}}),i=new(a().GameObjects.Image)(this.scene,0,-15,"game_menu","icon_leaderboard"),s=new(a().GameObjects.Text)(this.scene,0,35,"TOP",{fontFamily:"rubik",fontSize:24,color:"#3C2415"}),s.setOrigin(.5),t.add([i,s]),this.hover_interface.push(t),this.add(t),t=new S(this.scene,{x:e[1].x,y:e[1].y,atlas:"game_menu",frame_out:"basic_button",callback:()=>{k.windows_manager.show_window("daily_reward")}}),i=new(a().GameObjects.Image)(this.scene,0,-15,"game_menu","icon_daily"),s=new(a().GameObjects.Text)(this.scene,0,35,"DAILY",{fontFamily:"rubik",fontSize:24,color:"#3C2415"}),s.setOrigin(.5),t.add([i,s]),this.hover_interface.push(t),this.add(t),t=new S(this.scene,{x:e[2].x,y:e[2].y,atlas:"game_menu",frame_out:"basic_button",callback:()=>{k.big_windows.update_scenes("tasks"),k.update_scenes("big_windows")}}),this.add(t),i=new(a().GameObjects.Image)(this.scene,0,-15,"game_menu","icon_tasks"),s=new(a().GameObjects.Text)(this.scene,0,35,"MISSION",{fontFamily:"rubik",fontSize:18,color:"#3C2415"}),s.setOrigin(.5),t.add([i,s]),this.hover_interface.push(t),t=new S(this.scene,{x:e[3].x,y:e[3].y,atlas:"game_menu",frame_out:"basic_button",callback:()=>{k.big_windows.update_scenes("shop"),k.update_scenes("big_windows")}}),i=new(a().GameObjects.Image)(this.scene,0,-15,"game_menu","icon_store"),s=new(a().GameObjects.Text)(this.scene,0,35,"STORE",{fontFamily:"rubik",fontSize:24,color:"#3C2415"}),s.setOrigin(.5),t.add([i,s]),this.hover_interface.push(t),this.add(t),t=new S(this.scene,{x:e[4].x,y:e[4].y,atlas:"game_menu",frame_out:"basic_button",callback:()=>{this.game_map.active_map=!this.game_map.active_map,this.switch_interface(this.game_map.active_map)}}),i=new(a().GameObjects.Image)(this.scene,0,-15,"game_menu","icon_city"),s=new(a().GameObjects.Text)(this.scene,0,35,"CITY",{fontFamily:"rubik",fontSize:24,color:"#3C2415"}),s.setOrigin(.5),t.add([i,s]),this.add(t)}}class X extends a().GameObjects.Container{constructor(e,t){super(e),this.points_x=[],this.points_y=[],this.init(t)}on_turn(){this.turn=!0}off_turn(){this.turn=!1,this.points_x.forEach((e=>{e.visible=!1})),this.points_y.forEach((e=>{e.visible=!1}))}get_cell(e,t,i){return console.warn("old method",e,t,i),null}check_ship(e,t){console.warn("old_method",e,t)}hit(e,t,i,s){return console.warn("old method",e,t,i,s),!1}create_pointer(e,t){let i,s;this.setInteractive(new(a().Geom.Rectangle)(0,0,10*t,10*t),a().Geom.Rectangle.Contains);for(let e=0;e<10;e++)i=new(a().GameObjects.Image)(this.scene,0,0,"point_cell"),i.scale=t/i.width,i.y=e*t+t/2,i.alpha=.5,i.visible=!1,this.points_x.push(i),s=new(a().GameObjects.Image)(this.scene,0,0,"point_cell"),s.scale=t/s.width,s.x=e*t+t/2,s.alpha=.5,s.visible=!1,this.points_y.push(s);this.add(this.points_x),this.add(this.points_y);const n={x:0,y:0},o={x:0,y:0};this.on("pointermove",(e=>{n.x=t/2+Math.floor((e.x-this.x)/t)*t,n.y=t/2+Math.floor((e.y-this.y)/t)*t,this.points_x.forEach((e=>{e.x=n.x})),this.points_y.forEach((e=>{e.y=n.y}))})),this.on("pointerover",(e=>{this.over_cell=!0,this.turn&&(this.points_x.forEach((t=>{t.visible=e.isDown})),this.points_y.forEach((t=>{t.visible=e.isDown})))})),this.on("pointerout",(()=>{this.over_cell=!1,this.turn&&(this.points_x.forEach((e=>{e.visible=!1})),this.points_y.forEach((e=>{e.visible=!1})))})),this.on("pointerdown",(()=>{this.turn&&(this.points_x.forEach((e=>{e.visible=this.over_cell})),this.points_y.forEach((e=>{e.visible=this.over_cell})))})),this.on("pointerup",(e=>{this.turn&&(this.points_x.forEach((e=>{e.visible=!1})),this.points_y.forEach((e=>{e.visible=!1})),o.x=Math.floor((e.x-this.x)/t),o.y=Math.floor((e.y-this.y)/t),x.socket&&x.socket.shot(o.x,o.y))}))}play_anim_cell(e,t,i,s){const n=new(a().GameObjects.Sprite)(this.scene,e,t,s?"explo_1":"splash_1");s||(n.scale=.7),n.on("animationcomplete",(()=>{i&&(i.visible=!0),n.destroy()})),this.add(n),n.play(s?"explo":"splash")}show_cell(e,t,i,s){const n=new(a().GameObjects.Image)(this.scene,this.cell_width/2+this.cell_width*e,this.cell_width/2+this.cell_width*t,i?"cell_true":"cell_false");n.visible=!1,this.cells_container.add(n);const o=this.cell_width/2+e*this.cell_width,h=this.cell_width/2+t*this.cell_width;if(s){const e=new(a().GameObjects.Image)(this.scene,o,h,"projectile");e.setOrigin(1),this.add(e),this.scene.tweens.add({targets:e,scale:0,duration:300,onComplete:()=>{this.play_anim_cell(o,h,n,i)}})}else this.play_anim_cell(o,h,n,i)}show_ship(e,t,i,s,n){console.warn("1",e,t,i,s);let o=null;this.ships.forEach((i=>{i.x_in_field===e&&i.y_in_field===t&&(o=i)}));let h="ship_"+i;if(n&&(h+="_death"),o)!o.dead_in_field&&n&&(h=o.name+"_death"),o.setTexture(h);else{console.warn("3",e,t,i,s);const o=new(a().GameObjects.Image)(this.scene,this.cell_width/2+e*this.cell_width,this.cell_width/2+t*this.cell_width,h);o.scale=this.cell_width*i/o.width,o.setOrigin(this.cell_width/2/(o.width*o.scale),.5),o.setAngle(s?90:0),o.x_in_field=e,o.y_in_field=t,o.setName(h),o.dead_in_field=n,this.ships.push(o),this.ships_container.add(o)}}fill_ships(e){let t;e.forEach((e=>{t=e.y_l>e.x_l,this.show_ship(e.x,e.y,(t?e.y_l:e.x_l)+1,t,!1)}))}init(e){this.x=e.x,this.y=e.y;const t=1*x.cell_width+2;this.cell_width=t,this.ships=[],this.all_cells_count=0,this.all_ships_count=0,this.hited_ships_count=0,this.ships_container=new(a().GameObjects.Container)(this.scene),this.add(this.ships_container),this.cells_container=new(a().GameObjects.Container)(this.scene),this.add(this.cells_container),this.create_pointer(1,t)}}class V extends a().GameObjects.Container{constructor(e){super(e),this.init()}create_back(){this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(0,0,y.width,y.height);const e=Math.ceil(y.height/this.cell_width),t=Math.ceil(y.width/this.cell_width);this.bg.lineStyle(2,6386084,.7);for(let t=0;t<=e;t++)this.bg.lineBetween(0,t*this.cell_width,y.width,t*this.cell_width);for(let e=0;e<=t;e++)this.bg.lineBetween(e*this.cell_width,0,e*this.cell_width,y.height);this.bg.lineStyle(7,13582392,.9),this.bg.lineBetween(0,3*this.cell_width,y.width,3*this.cell_width),this.add(this.bg)}check_endgame(){return console.warn("old methods"),!1}anim_mine(e,t){const i=x.cell_width+2,s=new(a().GameObjects.Image)(this.scene,(e+.5)*i+this.first_player_field.x,(t+.5)*i+this.first_player_field.y,"mine");s.setScale(.8),s.alpha=0,this.anim_container.add(s),this.scene.tweens.add({targets:s,alpha:1,scale:1,duration:300,onComplete:()=>{const e=new(a().GameObjects.Sprite)(this.scene,s.x,s.y,"explo_3");e.on("animationcomplete",(()=>{e.destroy()})),e.alpha=1,this.anim_container.add(e),e.play("shot"),s.destroy()}})}show(){const e=1*x.cell_width+2;this.first_player_field=new X(this.scene,{x:2*e,y:5*e}),this.first_player_field.off_turn(),this.add(this.first_player_field);const t=x.game_play.fields[0].ships;console.warn(t),this.first_player_field.fill_ships(t),this.second_player_field=new X(this.scene,{x:16*e,y:5*e}),this.second_player_field.on_turn(),this.move_turn("first_player"),this.add(this.second_player_field),x.game_play.with_bot&&x.game_play.advanced&&this.create_skill_flat(),this.arsenal_button.visible=x.game_play.with_bot&&x.game_play.advanced}create_skill_flat(){const e=this.scene.plugins.get("rexshakepositionplugin");this.shake=e.add(this,{duration:4e3,mode:"effect"}),this.skill_flat_active=!0,this.skill_name="torpedo";const t=x.cell_width+2;this.skill_flat_container=new(a().GameObjects.Container)(this.scene,this.second_player_field.x+5*t,this.second_player_field.y+5*t),this.add(this.skill_flat_container),this.skill_flat_container.visible=!1;const i=new(a().GameObjects.Rectangle)(this.scene,0,0,10*t,10*t,16777215);i.alpha=.3,i.visible=!0,this.skill_flat_container.add(i),i.setInteractive();let s,n=!1;i.on("pointerdown",(()=>{this.skill_flat_active&&(n=!0)})).on("pointerup",(e=>{if(this.skill_flat_active){n=!1;let i=Math.floor((e.position.x-this.skill_flat_container.x+5*t)/t),s=Math.floor((e.position.y-this.skill_flat_container.y+5*t)/t);"bomber"===this.skill_name?(i<1&&(i=1),s<1&&(s=1),i>8&&(i=8),s>8&&(s=8),this.anim_bomber(i,s),this.bomber_mig.visible=!1):"atom"===this.skill_name?(i<1&&(i=1),s<1&&(s=1),i>6&&(i=6),s>6&&(s=6),this.anim_atom(i-1,s-1),this.atom_mig.visible=!1):"fighter"===this.skill_name?(s<1&&(s=1),i>7&&(i=7),i<1&&(i=1),this.anim_fighter(i,s),this.fighter_mig.visible=!1):"torpedo"===this.skill_name?(this.anim_torpedo(s),this.torpedo_mig.visible=!1):"radar"===this.skill_name?(i<1&&(i=1),s<1&&(s=1),i>8&&(i=8),s>8&&(s=8),this.anim_radar(i,s),this.radar_mig.visible=!1):"submarine"===this.skill_name&&(i<1&&(i=1),i>8&&(i=8),this.anim_submarine(i,s),this.submarine_mig.visible=!1),this.skill_flat_active=!1,this.skill_flat_container.visible=!1}})).on("pointerout",(()=>{this.skill_flat_active&&(n=!1)})).on("pointermove",(e=>{if(n&&this.skill_flat_active){let i=Math.floor((e.position.x-this.skill_flat_container.x+5*t)/t),s=Math.floor((e.position.y-this.skill_flat_container.y+5*t)/t);"bomber"===this.skill_name?(i<1&&(i=1),s<1&&(s=1),i>8&&(i=8),s>8&&(s=8),this.bomber_mig.setPosition(.5*t+t*i-5*t,.5*t+t*s-5*t)):"atom"===this.skill_name?(i<2&&(i=2),s<2&&(s=2),i>7&&(i=7),s>7&&(s=7),this.atom_mig.setPosition(.5*-t+t*i-5*t,.5*-t+t*s-5*t)):"radar"===this.skill_name?(i<1&&(i=1),s<1&&(s=1),i>8&&(i=8),s>8&&(s=8),this.radar_mig.setPosition(.5*t+t*i-5*t,.5*t+t*s-5*t)):"submarine"===this.skill_name?(i<1&&(i=1),i>8&&(i=8),this.submarine_mig.setPosition(.5*t+t*i-5*t,.5*t+t*s-5*t)):"fighter"===this.skill_name?(s<1&&(s=1),i>7&&(i=7),i<1&&(i=1),this.fighter_mig.setPosition(1.5*t+t*i-5*t,.5*t+t*s-5*t)):"torpedo"===this.skill_name&&(this.torpedo_mig.y=s*t+.5*t-4*t)}})),this.bomber_mig=new(a().GameObjects.Container)(this.scene,1.5*t-5*t,1.5*t-5*t),s=new(a().GameObjects.Image)(this.scene,1.5*t-t,1.5*t-t,"main_mig"),s.setScale(.8),this.bomber_mig.add(s),this.bomber_mig.visible=!1,this.skill_flat_container.add(this.bomber_mig),this.atom_mig=new(a().GameObjects.Container)(this.scene,1.5*t-5*t,1.5*t-5*t),s=new(a().GameObjects.Image)(this.scene,2*t-t,2*t-t,"main_mig"),this.atom_mig.add(s),s=new(a().GameObjects.Image)(this.scene,2*t-t,2*t-t,"atom_mig"),this.atom_mig.add(s),this.atom_mig.visible=!1,this.skill_flat_container.add(this.atom_mig),this.radar_mig=new(a().GameObjects.Container)(this.scene,1.5*t-5*t,1.5*t-5*t),s=new(a().GameObjects.Image)(this.scene,1*t-t,1*t-t,"main_mig"),s.setScale(.6),this.radar_mig.add(s),this.radar_mig.visible=!1,this.skill_flat_container.add(this.radar_mig),this.submarine_mig=new(a().GameObjects.Container)(this.scene,1.5*t-5*t,.5*t-5*t),s=new(a().GameObjects.Image)(this.scene,1*t-t,1*t-t,"main_mig"),s.setScale(.6,.2),this.submarine_mig.add(s),this.submarine_mig.visible=!1,this.skill_flat_container.add(this.submarine_mig),this.fighter_mig=new(a().GameObjects.Container)(this.scene,2.5*t-5*t,1.5*t-5*t),s=new(a().GameObjects.Image)(this.scene,2*-t+1.5*t,1*-t+.5*t,"main_mig"),s.setScale(.8,.4),this.fighter_mig.add(s),this.fighter_mig.visible=!1,this.skill_flat_container.add(this.fighter_mig),this.torpedo_mig=new(a().GameObjects.Container)(this.scene,.5*t,3.5*-t),s=new(a().GameObjects.Image)(this.scene,5*-t+4.5*t,1*-t+0*t,"main_mig"),s.setScale(2.05,.2),this.torpedo_mig.add(s),this.torpedo_mig.visible=!1,this.skill_flat_container.add(this.torpedo_mig),this.anim_container=new(a().GameObjects.Container)(this.scene),this.add(this.anim_container);const o=this.scene.make.graphics({});o.fillStyle(0,1),o.fillRect(2*t,0,24*t,y.height);const h=o.createGeometryMask();this.anim_container.setMask(h),this.flash=new(a().GameObjects.Rectangle)(this.scene,y.width/2,y.height/2,y.width,y.height,16777215,1),this.flash.alpha=0,this.add(this.flash)}hit_diapozone(e,t,i,s){let a=!1,n=!1;for(let o=0;o<s;o++)for(let s=0;s<i;s++)n=this.second_player_field.hit(e+s,t+o,!0),n&&(a=!0);return a}anim_bomber(e,t){const i=x.cell_width+2,s=new(a().GameObjects.Image)(this.scene,-300,t*i+this.second_player_field.y+.5*i,"skill_anim","bomber_0");s.setAngle(90),s.scale=1.2,this.anim_container.add(s),this.scene.tweens.add({targets:s,x:e*i+this.second_player_field.x-i,duration:3e3,onComplete:()=>{this.hit_diapozone(e-1,t-1,4,4),this.scene.tweens.add({targets:s,x:y.width+300,duration:3e3,onComplete:()=>{s.destroy()}})}})}anim_submarine(e,t){const i=new(a().GameObjects.Sprite)(this.scene,y.width/2,this.second_player_field.y+(t+.5)*this.cell_width,"skill_anim","submarine_0");i.setAngle(90);const s=new(a().GameObjects.Image)(this.scene,this.second_player_field.x+(e+1.5)*this.cell_width,this.second_player_field.y+(t+.5)*this.cell_width,"skill_anim","torpedo_down");s.visible=!1,s.setAngle(-90);const n=new(a().GameObjects.Image)(this.scene,this.second_player_field.x+(e+.5)*this.cell_width,this.second_player_field.y+(t+.5)*this.cell_width,"skill_anim","torpedo_down");n.visible=!1,n.setAngle(90),this.anim_container.add(n),this.anim_container.add(s),this.anim_container.add(i);let o=t-1;const h=t=>{o>0?this.scene.tweens.add({targets:s,y:`-=${this.cell_width}`,duration:300,onComplete:()=>{let i=!1;i=this.second_player_field.hit(e+1,o,!0),o--,i&&(o=-1),h(t+1)}}):this.scene.tweens.add({targets:s,alpha:0,duration:100,onComplete:()=>{o>-1&&this.second_player_field.hit(e+1,o,!0)}})};let r=t+1;const l=t=>{r<9?this.scene.tweens.add({targets:n,y:`+=${this.cell_width}`,duration:300,onComplete:()=>{let i=!1;i=this.second_player_field.hit(e,r,!0),r++,i&&(r=10),l(t+1)}}):this.scene.tweens.add({targets:n,alpha:0,duration:100,onComplete:()=>{r<10&&this.second_player_field.hit(e,r,!0)}})};this.scene.tweens.add({targets:i,x:this.second_player_field.x+(e+.5)*this.cell_width,duration:300*e+400,onComplete:()=>{this.scene.tweens.add({targets:this.second_player_field,alpha:.5,duration:500}),i.once("animationcomplete",(()=>{s.visible=!0,n.visible=!0,h(0),l(0),setTimeout((()=>{this.scene.tweens.add({targets:this.second_player_field,alpha:1,duration:500}),i.once("animationcomplete",(()=>{this.scene.tweens.add({targets:i,x:y.width+100,duration:3e3})})),i.play("submarine_down")}),1e3)})),i.play("submarine_up")}})}anim_atom(e,t){let i;const s=x.cell_width+2,n=new(a().GameObjects.Image)(this.scene,-300,t*s+this.second_player_field.y+1.5*s,"skill_anim","bomber_0");n.setAngle(90),n.scale=1.2,this.anim_container.add(n),this.scene.tweens.add({targets:n,x:e*s+this.second_player_field.x-s,duration:3e3,onComplete:()=>{i=new(a().GameObjects.Image)(this.scene,(e+1.5)*s+this.second_player_field.x,(t+1.5)*s+this.second_player_field.y,"under_explo"),i.scale=0,this.anim_container.add(i);const o=new(a().GameObjects.Sprite)(this.scene,(e+1.5)*s+this.second_player_field.x,(t+1.5)*s+this.second_player_field.y,"skill_anim","atom_explo_0");o.once("animationcomplete",(()=>{this.hit_diapozone(e-1,t-1,5,5),i=new(a().GameObjects.Image)(this.scene,(e+1.5)*s+this.second_player_field.x,(t+1.5)*s+this.second_player_field.y,"after_explo"),this.add(i),this.bringToTop(this.anim_container),this.scene.tweens.add({targets:o,alpha:0,duration:1e3,onComplete:()=>{o.destroy()}})})),this.anim_container.add(o),this.anim_container.sendToBack(o),this.scene.tweens.add({targets:i,scale:1,duration:100}),this.scene.tweens.add({targets:this.flash,duration:200,alpha:1,onComplete:()=>{i.destroy(),this.shake.shake(),setTimeout((()=>o.play("atom_explo")),1e3),this.scene.tweens.add({targets:this.flash,delay:1e3,duration:500,alpha:0,onComplete:()=>{}})}}),this.scene.tweens.add({targets:n,x:y.width+300,duration:3e3,onComplete:()=>{n.destroy()}})}})}anim_radar(e,t){const i=x.cell_width+2,s=[];let n,o;const h=new(a().GameObjects.Image)(this.scene,(e+.5)*i+this.second_player_field.x,(t+.5)*i+this.second_player_field.y,"skill_anim","radar_back");h.scale=.6,h.alpha=0,this.anim_container.add(h);const r=new(a().GameObjects.Image)(this.scene,(e+.5)*i+this.second_player_field.x,(t+.5)*i+this.second_player_field.y,"skill_anim","radar_arrow");r.setOrigin(0,0),r.scale=.6,r.alpha=0,this.anim_container.add(r),this.scene.tweens.add({targets:[h,r],alpha:1,duration:300}),this.scene.tweens.add({targets:[r],angle:720,duration:1e3,onComplete:()=>{this.scene.tweens.add({targets:[r],angle:720,duration:1e3}),this.scene.tweens.add({targets:[h,r],alpha:0,duration:300,onComplete:()=>{for(let h=t-1;h<t+2;h++)for(let t=e-1;t<e+2;t++)n=this.second_player_field.get_cell(t,h,!0),n&&n.succ&&(o=new(a().GameObjects.Image)(this.scene,t*i+16.5*i,h*i+5.5*i,"cell_false"),o.setTint(65280),o.alpha=0,this.add(o),s.push(o));this.scene&&this.scene.tweens.add({targets:s,alpha:1,duration:300,onComplete:()=>{this.scene&&this.scene.tweens.add({targets:s,alpha:0,delay:1e3,duration:300,onComplete:()=>{s.forEach((e=>e.destroy()))}})}})}})}})}anim_airdef(e,t){const i=new(a().GameObjects.Container)(this.scene,e?0:y.width,y.height+300);this.add(i);const s=new(a().GameObjects.Image)(this.scene,0,0,"skill_anim","airdef_back");s.setOrigin(e?0:1,1),i.add(s);const n=new(a().GameObjects.Image)(this.scene,e?80:-80,-30,"skill_anim","airdef");n.setFlipX(!e),n.setOrigin(e?1:0,1),i.add(n);const o=()=>{for(let i=0;i<8;i++){const i=a().Math.Between(0,9),s=a().Math.Between(t-1,t+1);setTimeout((()=>{const t=new(a().GameObjects.Sprite)(this.scene,(i+.5+(e?16:2))*this.cell_width,(s+5.5)*this.cell_width,"explo_3");t.on("animationcomplete",(()=>{t.destroy()})),t.alpha=.7,this.anim_container.add(t),t.play("shot")}),a().Math.Between(0,1500))}};this.scene.tweens.add({targets:i,y:y.height,delay:1e3,duration:500,onComplete:()=>{o(),this.scene.tweens.add({targets:i,y:y.height+300,delay:1500,duration:500})}})}anim_fighter(e,t){const i=x.cell_width+2,s=x.game_play.fields[1].airdef.includes(t),n=new(a().GameObjects.Container)(this.scene,-300,t*i+this.second_player_field.y-.5*i),o=new(a().GameObjects.Sprite)(this.scene,0,0,"skill_anim","fighter_0");o.scale=1.2,n.add(o),n.setAngle(90),this.anim_container.add(n),s?(this.anim_airdef(!1,t),this.scene.tweens.add({targets:n,x:7.5*i+this.first_player_field.x,duration:2500,onComplete:()=>{o.once("animationcomplete",(()=>{})),this.scene.tweens.add({targets:n,x:10.5*i+this.first_player_field.x,scale:.2,duration:1e3,onComplete:()=>{const e=new(a().GameObjects.Sprite)(this.scene,n.x,n.y,"splash_1");e.scale=.7,e.on("animationcomplete",(()=>{e.destroy()})),this.anim_container.add(e),e.play("splash"),o.destroy()}}),o.play("fighter_broke")}})):this.scene.tweens.add({targets:n,x:5*i+this.first_player_field.x,duration:1500,onComplete:()=>{o.once("animationcomplete",(()=>{})),this.scene.tweens.add({targets:n,x:e*i+this.second_player_field.x-i,duration:1500,onComplete:()=>{console.log("pih pah"),o.once("animationcomplete",(()=>{})),this.hit_diapozone(e-1,t-1,4,2),this.scene.tweens.add({targets:n,x:y.width+300,duration:1500,onComplete:()=>{o.destroy()}}),o.play("fighter_up")}}),o.play("fighter_down")}})}anim_torpedo(e){const t=x.cell_width+2,i=new(a().GameObjects.Image)(this.scene,this.second_player_field.x-50,(e+.5)*t+this.second_player_field.y,"skill_anim","torpedo_up"),s=new(a().GameObjects.Image)(this.scene,-300,(e+.5)*t+this.second_player_field.y,"skill_anim","torpedo_0");s.setAngle(90),s.scale=1.2,i.scale=1.2,i.visible=!1,this.anim_container.add(i),this.anim_container.add(s);let n=0;const o=s=>{n<9?this.scene.tweens.add({targets:i,x:`+=${t}`,duration:300,onComplete:()=>{let t=!1;t=this.second_player_field.hit(n,e,!0),n++,t&&(n=10),o(s+1)}}):this.scene.tweens.add({targets:i,alpha:0,duration:100,onComplete:()=>{n<10&&this.second_player_field.hit(n,e,!0)}})};this.scene.tweens.add({targets:s,x:this.second_player_field.x-50,duration:3e3,onComplete:()=>{i.visible=!0,o(0),this.scene.tweens.add({targets:i,duration:300,x:this.second_player_field.x+.5*t,scale:1,onComplete:()=>{i.setFrame("torpedo_down")}}),this.scene.tweens.add({targets:s,x:y.width+300,duration:3e3,onComplete:()=>{s.destroy()}})}})}clear_field(){this.first_player_field&&this.first_player_field.destroy(),this.second_player_field&&this.second_player_field.destroy()}set_timer(){this.timer&&this.timer.remove();let e=30;this.turn_timer.text=e.toString(),this.timer=this.scene.time.addEvent({delay:1e3,callback:()=>{e--,e>0?this.turn_timer.text=e.toString():x.socket&&x.socket.end_timer()},callbackScope:this,repeat:29})}move_turn(e){const t=x.game_play.with_bot;this.first_player_field.off_turn(),this.second_player_field.off_turn(),this.flip_arrow("second_player"===e,(()=>{"second_player"!==e||t||this.first_player_field.on_turn(),"first_player"===e&&this.second_player_field.on_turn()}))}flip_arrow(e,t){e!==this.turn_arrow.flipX?this.scene.tweens.add({targets:this.turn_arrow,duration:100,scaleX:0,onComplete:()=>{this.turn_arrow.setFlipX(e),this.scene.tweens.add({targets:this.turn_arrow,duration:100,scaleX:1,onComplete:()=>{t(),this.set_timer()}})}}):(t(),this.set_timer())}stop_timer(){this.timer&&this.timer.remove(),this.turn_timer.text=""}init(){this.scene.anims.create({key:"explo",frames:[{key:"explo_1"},{key:"explo_2"},{key:"explo_3"},{key:"explo_4"},{key:"explo_5"},{key:"explo_6"},{key:"explo_7"}],frameRate:16,showOnStart:!0,hideOnComplete:!0}),this.scene.anims.create({key:"shot",frames:[{key:"explo_3"},{key:"explo_4"},{key:"explo_5"},{key:"explo_6"},{key:"explo_7"}],frameRate:16,showOnStart:!0,hideOnComplete:!0}),this.scene.anims.create({key:"splash",frames:[{key:"splash_1"},{key:"splash_2"},{key:"splash_3"},{key:"splash_4"},{key:"splash_5"},{key:"splash_6"}],frameRate:16,showOnStart:!0,hideOnComplete:!0}),this.scene.anims.create({key:"fighter_broke",frames:[{key:"skill_anim",frame:"fighter_6"},{key:"skill_anim",frame:"fighter_7"},{key:"skill_anim",frame:"fighter_8"},{key:"skill_anim",frame:"fighter_9"},{key:"skill_anim",frame:"fighter_10"},{key:"skill_anim",frame:"fighter_11"},{key:"skill_anim",frame:"fighter_12"}],frameRate:6}),this.scene.anims.create({key:"fighter_down",frames:[{key:"skill_anim",frame:"fighter_0"},{key:"skill_anim",frame:"fighter_1"},{key:"skill_anim",frame:"fighter_2"},{key:"skill_anim",frame:"fighter_3"}],frameRate:6}),this.scene.anims.create({key:"fighter_up",frames:[{key:"skill_anim",frame:"fighter_3"},{key:"skill_anim",frame:"fighter_4"},{key:"skill_anim",frame:"fighter_5"},{key:"skill_anim",frame:"fighter_0"}],frameRate:6}),this.scene.anims.create({key:"atom_explo",frames:[{key:"skill_anim",frame:"atom_explo_1"},{key:"skill_anim",frame:"atom_explo_2"},{key:"skill_anim",frame:"atom_explo_3"},{key:"skill_anim",frame:"atom_explo_4"},{key:"skill_anim",frame:"atom_explo_5"},{key:"skill_anim",frame:"atom_explo_6"}],frameRate:6}),this.scene.anims.create({key:"submarine_up",frames:[{key:"skill_anim",frame:"submarine_0"},{key:"skill_anim",frame:"submarine_1"},{key:"skill_anim",frame:"submarine_2"},{key:"skill_anim",frame:"submarine_3"},{key:"skill_anim",frame:"submarine_4"}],frameRate:6}),this.scene.anims.create({key:"submarine_down",frames:[{key:"skill_anim",frame:"submarine_4"},{key:"skill_anim",frame:"submarine_3"},{key:"skill_anim",frame:"submarine_2"},{key:"skill_anim",frame:"submarine_1"},{key:"skill_anim",frame:"submarine_0"}],frameRate:6});const e=1*x.cell_width+2;this.cell_width=e,this.create_back(),this.first_bg=this.create_field(2*e,e),this.add(this.first_bg),this.second_bg=this.create_field(16*e,e),this.add(this.second_bg),this.turn_arrow=new(a().GameObjects.Image)(this.scene,14*e,10*e,"game_play","turn_arrow"),this.add(this.turn_arrow),this.turn_timer=new(a().GameObjects.Text)(this.scene,this.turn_arrow.x,this.turn_arrow.y,"",{fontFamily:"rubik",fontSize:36,strokeThickness:4,stroke:"#051F79"}),this.turn_timer.setOrigin(.5),this.add(this.turn_timer),this.create_profiles(e),this.home_button=new S(this.scene,{x:14*this.cell_width,y:14*this.cell_width+7,atlas:"new",frame_out:"mini_button",callback:()=>{k.windows_manager.show_window("quit_battle")}});let t=new(a().GameObjects.Image)(this.scene,0,-17,"new","home_icon");this.home_button.add(t);let i=new(a().GameObjects.Text)(this.scene,0,42,"HOME",{fontFamily:"rubik",fontSize:21});i.setOrigin(.5),this.home_button.add(i),this.add(this.home_button),this.chat_button=new S(this.scene,{x:14*this.cell_width,y:3*this.cell_width+7,atlas:"new",frame_out:"mini_button",callback:()=>{}}),t=new(a().GameObjects.Image)(this.scene,0,-17,"new","chat_icon"),this.chat_button.add(t),i=new(a().GameObjects.Text)(this.scene,0,42,"CHAT",{fontFamily:"rubik",fontSize:21}),i.setOrigin(.5),this.chat_button.add(i),this.chat_button.alpha=.7,this.add(this.chat_button),this.arsenal_button=new S(this.scene,{x:14*e,y:6*e+7,atlas:"new",frame_out:"mini_button",callback:()=>this.show_arsenal()}),t=new(a().GameObjects.Image)(this.scene,0,-17,"new","arsenal_icon"),this.arsenal_button.add(t),i=new(a().GameObjects.Text)(this.scene,0,42,"ARSENAL",{fontFamily:"rubik",fontSize:21}),i.setOrigin(.5),this.arsenal_button.add(i),this.add(this.arsenal_button)}create_arsenal(){const e=x.cell_width+2;let t;this.arsenal_container=new(a().GameObjects.Container)(this.scene,0,0),this.arsenal_container.setSize(2*y.width,2*y.height),this.arsenal_container.setInteractive(),this.arsenal_container.on("pointerdown",(()=>this.hide_arsenal())),this.arsenal_container.setVisible(!1),this.add(this.arsenal_container),this.arsenal_slider=new z(this.scene,{background:{frame:"arsenal_slider"}}),this.arsenal_slider.setXY(8*e,8.5*e),this.arsenal_container.add(this.arsenal_slider),["atom","bomber","torpedo","fighter","radar"].forEach(((i,s)=>{t=new(a().GameObjects.Image)(this.scene,4.6*e,s*e*4+1.8*e,"skill_item"),this.arsenal_slider.add_child(t),t.setInteractive(),t.on("pointerdown",(()=>{this.arsenal_slider.pointer_down=!0})),t.on("pointerup",(()=>{this.arsenal_slider.was_move?this.arsenal_slider.was_move=!1:(this.start_skill(i),this.hide_arsenal()),this.arsenal_slider.pointer_down=!1})),t.on("pointerout",(()=>{this.arsenal_slider.pointer_down=!1,this.arsenal_slider.was_move=!1})),t.on("pointermove",(e=>{this.arsenal_slider.emit("pointermove",e)})),t=new(a().GameObjects.Image)(this.scene,t.x,t.y+25,"skill_"+i),this.arsenal_slider.add_child(t),t=new(a().GameObjects.Text)(this.scene,t.x-200,t.y+50,`${x.user_data.skills[i].amount}`,{fontSize:24,strokeThickness:4,stroke:"#70fg09"}),t.setOrigin(.5,.5),this.arsenal_slider.add_child(t)}));const i=new S(this.scene,{x:14*e,y:6*e+7,atlas:"new",frame_out:"mini_button",callback:()=>this.show_arsenal()});t=new(a().GameObjects.Image)(this.scene,0,-17,"new","arsenal_icon"),i.add(t),this.add(i)}start_skill(e){x.user_data.skills[e].amount>0&&(x.user_data.skills[e].amount--,this.skill_flat_active=!0,this.skill_flat_container.visible=!0,"bomber"===e?(this.skill_name="bomber",this.bomber_mig.visible=!0):"atom"===e?(this.skill_name="atom",this.atom_mig.visible=!0):"fighter"===e?(this.skill_name="fighter",this.fighter_mig.visible=!0):"torpedo"===e?(this.skill_name="torpedo",this.torpedo_mig.visible=!0):"radar"===e?(this.skill_name="radar",this.radar_mig.visible=!0):"submarine"===e&&(this.skill_name="submarine",this.submarine_mig.visible=!0))}show_arsenal(){k.windows_manager.show_window("arsenal")}hide_arsenal(){}update_flag(){this.player_flag.setFrame(x.user_data.flag)}create_profiles(e){let t,i;const s=new(a().GameObjects.Container)(this.scene,2.65*e,2.35*e);this.add(s);const n=new(a().GameObjects.Image)(this.scene,0,0,"new","profile_ava"),o=new(a().GameObjects.Text)(this.scene,4.35*e,.12*e,x.user_data.name.toUpperCase(),{fontSize:28,fontFamily:"rubik",color:"#051F79"});o.setOrigin(.5,.5),t=new(a().GameObjects.Image)(this.scene,1.85*e,.12*e,"new","micro_plank"),s.add(t),t=new(a().GameObjects.Image)(this.scene,1.85*e,1.15*e,"new","micro_plank"),s.add(t),this.player_flag=new(a().GameObjects.Image)(this.scene,1.85*e,.12*e,"flags",x.user_data.flag),this.player_flag.scale=t.width/this.player_flag.width,s.add(this.player_flag),t=new(a().GameObjects.Image)(this.scene,1.85*e,1.15*e,"new","rank_micro"),s.add(t),t=new(a().GameObjects.Image)(this.scene,4.35*e,.12*e,"new","plank_frame"),s.add(t),t=new(a().GameObjects.Image)(this.scene,4.35*e,1.15*e,"new","plank_frame"),s.add(t),i=new(a().GameObjects.Text)(this.scene,4.35*e,1.15*e,x.user_data.rank.stage.toUpperCase(),{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),s.add(i),t=new(a().GameObjects.Image)(this.scene,6.85*e,.12*e,"new","micro_plank"),s.add(t),t=new(a().GameObjects.Image)(this.scene,6.85*e,1.15*e,"new","micro_plank"),s.add(t),t=new(a().GameObjects.Image)(this.scene,6.85*e,.12*e,"new","rating_micro_icon"),s.add(t),t=new(a().GameObjects.Image)(this.scene,6.85*e,1.15*e,"new","oil_icon"),s.add(t),t=new(a().GameObjects.Image)(this.scene,8.35*e,.12*e,"new","plank_frame_mini"),s.add(t),i=new(a().GameObjects.Text)(this.scene,8.35*e,.12*e,x.user_data.rating.score.toString().toUpperCase(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),s.add(i),t=new(a().GameObjects.Image)(this.scene,8.35*e,1.15*e,"new","plank_frame_mini"),s.add(t),i=new(a().GameObjects.Text)(this.scene,8.35*e,1.15*e,x.user_data.oil.amount.toString().toUpperCase(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),s.add(i),s.add([n,o]);const h=new(a().GameObjects.Container)(this.scene,25.3*e,2.35*e);this.add(h);const r=new(a().GameObjects.Image)(this.scene,0,0,"new","profile_ava");r.setFlipX(!0);const l=new(a().GameObjects.Text)(this.scene,-4.35*e,.12*e,"Bot".toUpperCase(),{fontSize:28,fontFamily:"rubik",color:"#051F79"});l.setOrigin(.5),t=new(a().GameObjects.Image)(this.scene,-1.85*e,.12*e,"new","micro_plank"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-1.85*e,1.15*e,"new","micro_plank"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-1.85*e,.12*e,"new","flag_micro"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-1.85*e,1.15*e,"new","rank_micro"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-4.35*e,.12*e,"new","plank_frame"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-4.35*e,1.15*e,"new","plank_frame"),h.add(t),i=new(a().GameObjects.Text)(this.scene,-4.35*e,1.15*e,x.user_data.rank.stage.toUpperCase(),{fontFamily:"rubik",fontSize:28,color:"#051F79"}),i.setOrigin(.5),h.add(i),t=new(a().GameObjects.Image)(this.scene,-6.85*e,.12*e,"new","micro_plank"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-6.85*e,.12*e,"new","rating_micro_icon"),h.add(t),t=new(a().GameObjects.Image)(this.scene,-8.35*e,.12*e,"new","plank_frame_mini"),h.add(t),i=new(a().GameObjects.Text)(this.scene,-8.35*e,.12*e,(x.user_data.rating.score+Math.floor(100*(Math.random()-Math.random()))).toString().toUpperCase(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),h.add(i),h.add([r,l])}create_field(e,t){const i=new(a().GameObjects.Container)(this.scene,e,5*t),s=new(a().GameObjects.Graphics)(this.scene);s.fillStyle(16777215,0);const n=10*t,o=10*t;s.fillRect(0,0,n,o),i.add(s);const h=new(a().GameObjects.Image)(this.scene,5*t,5*t,"new","field_frame");let r;return h.setScale(1.05),i.add(h),["A","B","C","D","E","F","G","H","I","J"].forEach(((s,n)=>{r=new(a().GameObjects.Text)(this.scene,e<y.width/2?-.5*t:10.5*t,.5*t+t*n,s,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),r.setOrigin(.5),i.add(r),r=new(a().GameObjects.Text)(this.scene,.5*t+t*n,-.5*t,n.toString(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),r.setOrigin(.5),i.add(r)})),i}handler_close(){}}class Y extends a().GameObjects.Container{constructor(e){super(e),this.name="prepare_field",this.init()}create_back(){this.cell_width=x.cell_width,this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(0,0,y.width,y.height);const e=Math.ceil(y.height/this.cell_width),t=Math.ceil(y.width/this.cell_width);this.bg.lineStyle(2,6386084,.7);for(let t=0;t<=e;t++)this.bg.lineBetween(0,t*this.cell_width,y.width,t*this.cell_width);for(let e=0;e<=t;e++)this.bg.lineBetween(e*this.cell_width,0,e*this.cell_width,y.height);this.bg.lineStyle(7,13582392,.9),this.bg.lineBetween(0,3*this.cell_width,y.width,3*this.cell_width),this.add(this.bg)}show(){x.game_play.fields.length>0?this.ships=x.game_play.fields[0].ships:this.ships=[],this.fill_ships(x.cell_width)}create_bar(){const e=x.cell_width,t=new(a().GameObjects.Image)(this.scene,17.5*e,3.5*e,"game_play","oil_icon");this.oil_bar=new n(this.scene,{atlas:"new",frame_bar:"oil_progress"}),this.oil_bar.setPosition(22*e,3.5*e),this.oil_bar.scaleX=1.02,this.dot_oil_button=new S(this.scene,{x:26.5*e,y:3.5*e,atlas:"new",frame_out:"button_plus",callback:()=>{x.user_data.oil.amount=x.user_data.oil.max,this.update_oil()}}),this.oil_txt=new(a().GameObjects.Text)(this.scene,this.oil_bar.x,this.oil_bar.y,"",{fontFamily:"rubik",fontSize:36,strokeThickness:4,stroke:"#072279"}),this.oil_txt.setOrigin(.5),this.update_oil(),this.add([t,this.oil_bar,this.dot_oil_button,this.oil_txt])}update_oil(){this.oil_bar.update_progress(x.user_data.oil.amount/x.user_data.oil.max),this.oil_txt.text=`${x.user_data.oil.amount} / ${x.user_data.oil.max}`}create_arsenal(){const e=x.cell_width;let t;this.arsenal_slider=new z(this.scene,{width:11*e,height:9*e}),this.arsenal_slider.setXY(22.15*e,8.45*e),this.add(this.arsenal_slider),this.skill_txts={},["atom","bomber","torpedo","fighter","airdef","submarine","radar","mine"].forEach(((i,s)=>{t=new(a().GameObjects.Image)(this.scene,4.6*e,s*e*4+1.8*e,"skill_item"),this.arsenal_slider.add_child(t),t.setInteractive(),t.on("pointerdown",(()=>{this.arsenal_slider.pointer_down=!0})),t.on("pointerup",(()=>{this.arsenal_slider.was_move?this.arsenal_slider.was_move=!1:"airdef"===i||"mine"===i?this.start_skill(i):this.handler_buy(i),this.arsenal_slider.pointer_down=!1})),t.on("pointerout",(()=>{this.arsenal_slider.pointer_down=!1,this.arsenal_slider.was_move=!1})),t.on("pointermove",(e=>{this.arsenal_slider.emit("pointermove",e)})),t=new(a().GameObjects.Image)(this.scene,t.x,t.y+25,"skill_"+i),this.arsenal_slider.add_child(t),t=new(a().GameObjects.Text)(this.scene,t.x-230,t.y+50,`${x.user_data.skills[i].amount}/${x.skills[i].max}`,{fontFamily:"rubik",fontSize:36,color:"#072279"}),t.setOrigin(.5,.5),this.arsenal_slider.add_child(t),this.skill_txts[i]=t,t=new(a().GameObjects.Text)(this.scene,t.x+460,t.y,`${x.skills[i].price}`,{fontFamily:"rubik",fontSize:36,color:"#072279"}),t.setOrigin(.5),this.arsenal_slider.add_child(t),t=new(a().GameObjects.Image)(this.scene,t.x-80,t.y,"oil_can"),t.scale=.7,this.arsenal_slider.add_child(t)}))}handler_buy(e){const t=x.user_data.skills,i=x.skills,s=x.user_data.oil,a=i[e].price;t[e].amount+1<=i[e].max&&s.amount>=a&&(s.amount-=a,t[e].amount++),this.update_skill_amount(e),this.update_oil()}update_skill_amount(e){this.skill_txts[e].text=`${x.user_data.skills[e].amount}/${x.skills[e].max}`}fill_ships(e){let t,i;this.ships.forEach((s=>{i=s.y_l>s.x_l,t=new(a().GameObjects.Image)(this.scene,e/2+s.x*e+3*e,e/2+s.y*e+5*e,"ship_"+(i?s.y_l+1:s.x_l+1)),t.scale=e*(i?s.y_l+1:s.x_l+1)/t.width,t.setOrigin(e/2/(t.width*t.scale),.5),t.setAngle(i?90:0),this.add(t)}))}update_buttons(){}create_buttons(e,t){let i,s;this.video_button=new S(this.scene,{x:15*t,y:11*t+7,atlas:"game_play",frame_out:"mini_button",callback:()=>{k.windows_manager.show_window("video_oil")}}),i=new(a().GameObjects.Image)(this.scene,-5,-17,"new","oil_icon_dark"),this.video_button.add(i),s=new(a().GameObjects.Text)(this.scene,0,42,"+600",{fontFamily:"rubik",fontSize:30,color:"#2BFF2B"}),s.setOrigin(.5),this.video_button.add(s),this.add(this.video_button),this.restart_button=new S(this.scene,{x:15*t,y:14*t+7,atlas:"game_play",frame_out:"mini_button",callback:()=>{x.user_data.oil.amount=x.user_data.oil.max,this.update_oil(),Object.keys(x.user_data.skills).forEach((e=>{x.user_data.skills[e].amount=0,this.update_skill_amount(e)}))}}),i=new(a().GameObjects.Image)(this.scene,0,-17,"game_play","rotate_icon"),this.restart_button.add(i),s=new(a().GameObjects.Text)(this.scene,0,42,"AUTO",{fontFamily:"rubik",fontSize:21}),s.setOrigin(.5),this.restart_button.add(s),this.add(this.restart_button),this.play_button=new S(this.scene,{x:16*t+6*t,y:14*t,frame_out:"next_play_button",callback:()=>{k.game_play.update_scenes("game_play")}}),s=new(a().GameObjects.Text)(this.scene,0,0,"BATTLE",{fontFamily:"rubik",fontSize:64}),s.setOrigin(.5),this.play_button.add(s),this.add(this.play_button)}init(){const e=1*x.cell_width;this.create_back();let t=new(a().GameObjects.Image)(this.scene,8*e,3.5*e+2,"new","plank");t.scale=10*e/t.width,this.add(t);const i=new(a().GameObjects.Text)(this.scene,8*e,3.5*e+2,"SEA MAP",{fontFamily:"rubik",fontSize:36});i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,22*e,3.5*e+2,"new","plank"),t.scale=10*e/t.width,this.add(t),this.create_field(e),this.create_bar(),this.create_arsenal(),this.create_buttons(1,e),this.create_skill_flat()}handler_close(){}create_skill_flat(){const e=x.cell_width;this.skill_flat_active=!0,this.skill_name="torpedo",this.skill_flat_container=new(a().GameObjects.Container)(this.scene,3*e,5*e),this.add(this.skill_flat_container),this.skill_flat_container.visible=!1;const t=new(a().GameObjects.Rectangle)(this.scene,5*e,5*e,10*e,10*e,16777215,1);t.alpha=.3,t.visible=!0,this.skill_flat_container.add(t),t.setInteractive();let i=!1;t.on("pointerdown",(()=>{this.skill_flat_active&&(i=!0)})).on("pointerup",(t=>{if(this.skill_flat_active){i=!1;const s=Math.floor((t.position.y-this.skill_flat_container.y)/e),a=Math.floor((t.position.x-this.skill_flat_container.x)/e);"airdef"===this.skill_name?(x.game_play.fields[0].airdef.push(s,s+1),this.handler_buy("airdef")):"mine"===this.skill_name&&(x.game_play.fields[0].mine.push({x:a,y:s}),this.handler_buy("mine")),this.skill_flat_active=!1,this.skill_flat_container.visible=!1}})).on("pointerout",(()=>{this.skill_flat_active&&(i=!1)})).on("pointermove",(t=>{if(i&&this.skill_flat_active){let i=Math.floor((t.position.y-this.skill_flat_container.y)/e);const s=Math.floor((t.position.x-this.skill_flat_container.x)/e);"airdef"===this.skill_name?(i<0&&(i=0),i>8&&(i=8),this.airdef_mig.y=1*e+e*i):"mine"===this.skill_name&&(i<0&&(i=0),i>9&&(i=9),this.mine_mig.y=.5*e+e*i,this.mine_mig.x=.5*e+e*s)}})),this.airdef_mig=new(a().GameObjects.Image)(this.scene,5*e,1*e,"main_mig"),this.airdef_mig.setScale(2,.4),this.airdef_mig.visible=!1,this.skill_flat_container.add(this.airdef_mig),this.mine_mig=new(a().GameObjects.Image)(this.scene,.5*e,.5*e,"skill_anim","mine"),this.mine_mig.setScale(.8),this.mine_mig.visible=!1,this.skill_flat_container.add(this.mine_mig)}start_skill(e){this.skill_flat_active=!0,this.skill_flat_container.visible=!0,"airdef"===e&&(this.skill_name="airdef",this.airdef_mig.visible=!0),"mine"===e&&(this.skill_name="mine",this.mine_mig.visible=!0)}create_field(e){this.field_frame=new(a().GameObjects.Graphics)(this.scene),this.field_frame.fillStyle(16777215,0);const t=3*e,i=3.5*e,s=10*e,n=10*e;this.field_frame.fillRect(t,i,s,n),this.add(this.field_frame);const o=new(a().GameObjects.Image)(this.scene,8*e,10*e,"new","field_frame");let h;o.setScale(1.02),this.add(o),["A","B","C","D","E","F","G","H","I","J"].forEach(((t,i)=>{h=new(a().GameObjects.Text)(this.scene,2.5*e,5.5*e+e*i,t,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),h.setOrigin(.5),this.add(h),h=new(a().GameObjects.Text)(this.scene,3.5*e+e*i,4.5*e,i.toString(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),h.setOrigin(.5),this.add(h)}))}}class U{constructor(){this.field=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.socket_field=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.socket_field.forEach(((e,t)=>{e.forEach(((e,i)=>{this.socket_field[t][i]={x:i,y:t,type:"empty"}}))})),this.ships=[]}get_filling(){let e=0;return this.field.forEach((t=>{t.forEach((t=>{1===t&&e++}))})),e}is_posible(e,t,i){let s;return s=i?this.field[t]&&0===this.field[t][e]:!this.field[t]||!this.field[t][e]||1!==this.field[t][e],s}is_posible_ship(e,t,i,s){let a=!0;const n=e+i,o=t+s;for(let h=t-1;h<t+s+2;h++)for(let r=e-1;r<e+i+2;r++){const l=h>=t&&h<t+s&&(s>0||h===t)&&r>=e&&r<e+i&&(i>0||r===e);(!this.is_posible(r,h,l)||n>9||o>9)&&(a=!1)}return a}update_field(){this.clear_field(),this.ships.forEach((e=>{this.add_ship(e,!0)}))}remove_ship(e){const{x:t,y:i,x_l:s,y_l:a}=e;let n=-1;this.ships.forEach(((e,o)=>{e.x==t&&e.y==i&&e.x_l==s&&e.y_l==a&&(n=o)})),-1!==n?(this.ships.splice(n,1),this.update_field()):(console.trace(this.ships),console.trace(e),console.trace("Ship not found"))}clear_ships(){this.ships=[]}clear_field(){this.field=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]]}clear(){this.clear_field(),this.clear_ships()}add_ship(e,t){const{x:i,y:s,x_l:a,y_l:n}=e;let o="";if(e.name&&(o=e.name),this.is_posible_ship(i,s,a,n)){let e=!0;for(let t=s;t<=s+n;t++)for(let s=i;s<=i+a;s++)t>=0&&t<=9&&s>=0&&s<=9?(this.field[t][s]=1,o.length>0&&(this.socket_field[t][s]={x:s,y:t,type:"ship",ship:{id:o,shipSize:a>n?a:n,orientation:a>n?"horizontal":"vertical"}})):e=!1;let h=-1;return this.ships.forEach(((e,t)=>{e.x==i&&e.y==s&&e.x_l==a&&e.y_l==n&&(h=t)})),e&&-1===h&&!t&&this.ships.push({x:i,y:s,x_l:a,y_l:n}),!0}return!1}}var H=i(359);class ${constructor(){this.init()}init(){this.socket=(0,H.io)(h+"battle/with-bot",{transports:["websocket"],auth:{token:`Bearer ${localStorage.getItem(r)}`}}),this.socket.on("connect",(()=>{console.log("connected"),this.init_server_side_events()}))}init_server_side_events(){this.socket.on("failure",(e=>{console.log(e)})),this.socket.on("turn",(e=>{console.log(e),k.game_play.game_play&&k.game_play.game_play.move_turn(e.turn)})),this.socket.on("finish",(e=>{const t="first_player"===JSON.parse(e).winner;x.game_play.fields=[],k.windows_manager.show_window("result_battle",{win:t})})),this.socket.on("first-player-shoted",(e=>{console.log(e),e.forEach(((e,t)=>{k.game_play.game_play.second_player_field&&"destroyed"!==e.type&&k.game_play.game_play.second_player_field.show_cell(e.x,e.y,"damaged"===e.type,0===t&&"destroyed"!=e.type)}));const t=e.filter((e=>"destroyed"===e.type));if(t.length>0){let e=9,i=9;t.forEach(((s,a)=>{s.x<e&&(e=s.x),s.y<i&&(i=s.y),a===t.length-1&&k.game_play.game_play.second_player_field.show_ship(e,i,s.ship.shipSize,"vertical"===s.ship.orientation,!0)}))}})),this.socket.on("second-player-shoted",(e=>{console.log(e),e.forEach(((e,t)=>{k.game_play.game_play.first_player_field&&"destroyed"!==e.type&&k.game_play.game_play.first_player_field.show_cell(e.x,e.y,"damaged"===e.type,0===t&&"destroyed"!=e.type)}));const t=e.filter((e=>"destroyed"===e.type));if(t.length>0){let e=9,i=9;t.forEach(((s,a)=>{s.x<e&&(e=s.x),s.y<i&&(i=s.y),a===t.length-1&&k.game_play.game_play.first_player_field.show_ship(e,i,s.ship.shipSize,"vertical"===s.ship.orientation,!0)}))}})),this.socket.on("finish",(()=>{}))}init_with_bot(e,t){this.socket.once("success",(()=>{t()})),this.socket.emit("init-game-with-bot",e)}end_timer(){this.socket.emit("turn-skip")}shot(e,t){const i={x:e,y:t};this.socket.emit("shot",i,(e=>{console.log(e)}))}}class W extends a().GameObjects.Container{constructor(e){super(e),this.name="prepare_field",this.init()}create_back(){this.cell_width=x.cell_width,this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(0,0,y.width,y.height);const e=Math.ceil(y.height/this.cell_width),t=Math.ceil(y.width/this.cell_width);this.bg.lineStyle(2,6386084,.7);for(let t=0;t<=e;t++)this.bg.lineBetween(0,t*this.cell_width,y.width,t*this.cell_width);for(let e=0;e<=t;e++)this.bg.lineBetween(e*this.cell_width,0,e*this.cell_width,y.height);this.bg.lineStyle(7,13582392,.9),this.bg.lineBetween(0,3*this.cell_width,y.width,3*this.cell_width),this.add(this.bg)}show(){this.clear_ships(),this.prepare_frame.clear(),this.update_buttons()}create_drop_zone(e,t){this.drop_zone={x:3*t,y:5*t,width:10*t,height:10*t}}clear_fantoms(){this.fantoms&&this.fantoms.forEach((e=>{e.visible=!1,e.setPosition(0,0)}))}clear_ships(){this.ships&&(this.ships.forEach((e=>{e.destroy()})),this.ships=[]);const e=1*x.cell_width;this.create_ships(1,e)}create_fantoms_ships(e,t){this.fantoms_true=[new(a().GameObjects.Image)(this.scene,0,0,"ship_1_green").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_2_green").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_3_green").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_4_green").setScale(e)],this.fantoms_false=[new(a().GameObjects.Image)(this.scene,0,0,"ship_1_red").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_2_red").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_3_red").setScale(e),new(a().GameObjects.Image)(this.scene,0,0,"ship_4_red").setScale(e)],this.fantoms=[...this.fantoms_true,...this.fantoms_false],this.fantoms_of_color={_green:this.fantoms_true,_red:this.fantoms_false},this.fantoms.forEach((e=>{e.setOrigin(t/2/(e.width*e.scale),.5),e.visible=!1})),this.add(this.fantoms)}is_in_dropzone(e,t){return e>this.drop_zone.x&&e<this.drop_zone.x+this.drop_zone.width&&t>this.drop_zone.y&&t<this.drop_zone.y+this.drop_zone.height}catch_stand(e){e.setOrigin(0,1),e.vertical=!1,e.setAngle(0),e.stand=!1,this.last_ship=null,e.x=e.stand_coords.x,e.y=e.stand_coords.y,this.update_buttons()}set_drag_interactive(e,t,i){const s={x:0,y:0},a={x:0,y:0};let n={x:e.x+i/2,y:e.y-i/2};const o={x:0,y:0};e.stand_coords={x:e.x,y:e.y},e.setInteractive({draggable:!0});let h=!1;e.on("pointerdown",((t,i,a)=>{h=!1,e.stand&&(this.last_ship=e),s.x=i,s.y=a})),e.on("pointerup",(()=>{!h&&this.is_rotate_ship()&&this.rotate_ship()})),e.on("dragstart",(()=>{this.clear_fantoms(),e.stand&&this.prepare_frame.remove_ship({x:e.index_pos.x,y:e.index_pos.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}),this.update_buttons()})),e.on("drag",(t=>{if(h=!0,this.clear_fantoms(),a.x=t.worldX-s.x+(e.stand?i/2:0),a.y=t.worldY+s.y-(e.stand?i/2:0),e.setPosition(a.x,a.y),n={x:e.x+(e.stand?0:i/2),y:e.y-(e.stand?0:i/2)},this.prepare_frame.update_field(),this.is_in_dropzone(n.x,n.y)){o.x=Math.floor((n.x-this.drop_zone.x)/i),o.y=Math.floor((n.y-this.drop_zone.y)/i);const t={x:o.y+(e.vertical&&e.index>0?e.index:0),y:o.x+(!e.vertical&&e.index>0?e.index:0)};if(t.x>=0&&t.x<=9&&t.y>=0&&t.y<=9){const t=this.prepare_frame.is_posible_ship(o.x,o.y,e.vertical?0:e.index,e.vertical?e.index:0)?"_green":"_red",s=this.fantoms_of_color[t][e.index];s.setPosition(this.drop_zone.x+i/2+o.x*i,this.drop_zone.y+i/2+o.y*i),s.setScale(e.scale),s.setOrigin(i/2/(s.width*s.scale),.5),s.setAngle(e.vertical?90:0),s.visible=!0}else this.clear_fantoms()}else this.clear_fantoms()})),e.on("drop",((e,t,i)=>{t.x=i.x,t.y=i.y,t.input.enabled=!1})),e.on("dragend",(()=>{this.clear_fantoms(),n={x:e.x+(e.stand?0:i/2),y:e.y-(e.stand?0:i/2)},this.is_in_dropzone(n.x,n.y)?(o.x=Math.floor((n.x-this.drop_zone.x)/i),o.y=Math.floor((n.y-this.drop_zone.y)/i),this.prepare_frame.add_ship({name:e.name,x:o.x,y:o.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0})?(e.stand=!0,e.index_pos=o,e.setOrigin(i/2/(e.width*e.scale),.5),e.setPosition(this.drop_zone.x+i/2+o.x*i,this.drop_zone.y+i/2+o.y*i),this.last_ship=e,this.update_buttons()):this.catch_stand(e)):(e.stand&&this.prepare_frame.remove_ship({x:e.index_pos.x,y:e.index_pos.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}),this.catch_stand(e))}))}create_ships(e,t){const i=x.game_play.default_rules;let s,n,o,h,r;this.ships=[];for(const l in i.ships.boats){s={x:26*t,y:12*t},n=i.ships.boats[l],o="ship_",r=parseInt(l),o+=r+1,s.y-=2*r*t;for(let i=0;i<n;i++)h=new(a().GameObjects.Image)(this.scene,s.x-(i+1)*(2+r)*t,s.y,o),h.setOrigin(0,1),h.setScale(t/h.height),h.index=r,h.vertical=!1,h.setName(i+"_"+(r+1)),this.add(h),this.ships.push(h),this.set_drag_interactive(h,e,t)}}is_rotate_ship(){const e=this.last_ship,t={x:0,y:0,x_l:0,y_l:0};let i=!1;if(e){let s=-1;t.x=e.index_pos.x,t.y=e.index_pos.y,t.x_l=e.vertical?0:e.index,t.y_l=e.vertical?e.index:0,this.prepare_frame.ships.forEach(((e,i)=>{e.x==t.x&&e.y==t.y&&e.x_l==t.x_l&&e.y_l==t.y_l&&(s=i)})),s>=0&&(this.prepare_frame.remove_ship({x:t.x,y:t.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}),e.vertical=!e.vertical,i=this.prepare_frame.is_posible_ship(t.x,t.y,e.vertical?0:e.index,e.vertical?e.index:0),e.vertical=!e.vertical,this.prepare_frame.add_ship({name:e.name,x:t.x,y:t.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}))}return i}rotate_ship(){const e=this.last_ship;e&&(this.prepare_frame.remove_ship({x:e.index_pos.x,y:e.index_pos.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}),e.vertical=!e.vertical,e.setAngle(e.vertical?90:0),this.prepare_frame.add_ship({name:e.name,x:e.index_pos.x,y:e.index_pos.y,x_l:e.vertical?0:e.index,y_l:e.vertical?e.index:0}))}is_random(){return 0===this.prepare_frame.ships.length}random_field(){const e=1*x.cell_width,t=this.ships.length;let i,s=!1,n=0,o=0;const h=()=>{s=Math.random()>.5,n=a().Math.Between(0,9),o=a().Math.Between(0,9),this.prepare_frame.add_ship({name:i.name,x:n,y:o,x_l:s?0:i.index,y_l:s?i.index:0})?(i.stand=!0,i.index_pos={x:n,y:o},i.setOrigin(e/2/(i.width*i.scale),.5),i.setAngle(s?90:0),i.setPosition(this.drop_zone.x+e/2+n*e,this.drop_zone.y+e/2+o*e),this.last_ship=i,this.update_buttons()):h()};for(let e=t-1;e>=0;e--)i=this.ships[e],h()}random_bot_field(){const e=x.game_play.default_rules;let t=!1,i=0,s=0,n=0,o=0;const h=e=>{t=Math.random()>.5,i=a().Math.Between(0,9),s=a().Math.Between(0,9),this.prepare_frame.add_ship({x:i,y:s,x_l:t?0:e,y_l:t?e:0})||h(e)};for(const t in e.ships.boats){n=e.ships.boats[t],o=parseInt(t);for(let e=0;e<n;e++)h(o)}}update_buttons(){this.is_rotate=this.is_rotate_ship(),this.is_random_field=this.is_random(),this.is_bot=x.game_play.with_bot,this.done_field=this.prepare_frame.get_filling()>=x.game_play.default_rules.filling,this.done_icon.visible=this.done_field,this.random_button.alpha=this.is_random_field?1:.7,this.play_button.alpha=this.done_field?1:.7}create_buttons(e,t){let i,s;this.save_button=new S(this.scene,{x:15*t,y:6*t+7,atlas:"game_play",frame_out:"mini_button",callback:()=>{k.windows_manager.show_window("save_field")}}),i=new(a().GameObjects.Image)(this.scene,0,-17,"game_play","save_icon_dark"),this.save_button.add(i),s=new(a().GameObjects.Text)(this.scene,0,42,"SAVE",{fontFamily:"rubik",fontSize:21}),s.setOrigin(.5),this.save_button.add(s),this.add(this.save_button),this.random_button=new S(this.scene,{x:15*t,y:11*t+7,atlas:"game_play",frame_out:"mini_button",callback:()=>{this.is_random()&&this.random_field()}}),i=new(a().GameObjects.Image)(this.scene,0,-17,"new","auto_icon"),this.random_button.add(i),s=new(a().GameObjects.Text)(this.scene,0,42,"AUTO",{fontFamily:"rubik",fontSize:21}),s.setOrigin(.5),this.random_button.add(s),this.add(this.random_button),this.reset_button=new S(this.scene,{x:15*t,y:14*t+7,atlas:"game_play",frame_out:"mini_button",callback:()=>{this.is_rotate_ship()&&this.rotate_ship()}}),i=new(a().GameObjects.Image)(this.scene,0,-17,"new","reset_icon"),this.reset_button.add(i),s=new(a().GameObjects.Text)(this.scene,0,42,"ROTATE",{fontFamily:"rubik",fontSize:21}),s.setOrigin(.5),this.reset_button.add(s),this.add(this.reset_button),this.play_button=new S(this.scene,{x:this.reset_button.x+7*t,y:this.reset_button.y-7,frame_out:"next_play_button",callback:()=>{this.prepare_frame.get_filling()>=x.game_play.default_rules.filling&&(x.game_play.fields.push({field:this.prepare_frame.field,ships:this.prepare_frame.ships,airdef:[],mine:[]}),this.is_bot?"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname?this.init_socket():k.game_play.update_scenes("game_play"):x.game_play.fields.length<2?(this.prepare_frame.clear(),this.done_icon.visible=!1,k.game_play.update_scenes("prepare_field")):(this.prepare_frame.clear(),this.done_icon.visible=!1,k.game_play.update_scenes("game_play")))}}),s=new(a().GameObjects.Text)(this.scene,0,0,"BATTLE",{fontFamily:"rubik",fontSize:64}),s.setOrigin(.5),this.play_button.add(s),this.add(this.play_button),this.update_buttons()}init_socket(){x.socket=new $,x.socket.init_with_bot({rate:0,grid:this.prepare_frame.socket_field},(()=>{k.game_play.update_scenes("game_play")}))}init(){const e=1*x.cell_width;this.create_back(),this.done_icon=new(a().GameObjects.Image)(this.scene,22*e,9*e,"game_play","done_icon"),this.add(this.done_icon);let t=new(a().GameObjects.Image)(this.scene,8*e,3.5*e+2,"new","plank");t.scale=10*e/t.width,this.add(t);let i=new(a().GameObjects.Text)(this.scene,8*e,3.5*e+2,"SEA MAP",{fontFamily:"rubik",fontSize:36});i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,21*e,3.5*e+2,"new","plank"),t.scale=10*e/t.width,this.add(t),i=new(a().GameObjects.Text)(this.scene,21*e,3.5*e+2,"SHIPS",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),this.create_field(e),this.prepare_frame=new U,this.create_drop_zone(1,e),this.create_fantoms_ships(1,e),this.create_ships(1,e),this.create_buttons(1,e)}handler_close(){this.clear_fantoms(),this.prepare_frame.clear(),this.clear_ships()}create_field(e){this.field_frame=new(a().GameObjects.Graphics)(this.scene),this.field_frame.fillStyle(16777215,0);const t=3*e,i=5*e,s=10*e,n=10*e;this.field_frame.fillRect(t,i,s,n),this.add(this.field_frame);const o=new(a().GameObjects.Image)(this.scene,8*e,10*e,"new","field_frame");let h;o.scale=1.02,this.add(o),["A","B","C","D","E","F","G","H","I","J"].forEach(((t,i)=>{h=new(a().GameObjects.Text)(this.scene,2.5*e,5.5*e+e*i,t,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),h.setOrigin(.5),this.add(h),h=new(a().GameObjects.Text)(this.scene,3.5*e+e*i,4.5*e,i.toString(),{fontFamily:"rubik",fontSize:36,color:"#051F79"}),h.setOrigin(.5),this.add(h)}))}}class q extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.cell_width=x.cell_width,this.create_back(),this.create_interface(),this.create_scenes()}create_back(){this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(0,0,y.width,y.height),this.add(this.bg);const e=Math.ceil(y.height/this.cell_width),t=Math.ceil(y.width/this.cell_width);this.bg.lineStyle(2,6386084,.7);for(let t=0;t<=e;t++)this.bg.lineBetween(0,t*this.cell_width,y.width,t*this.cell_width);for(let e=0;e<=t;e++)this.bg.lineBetween(e*this.cell_width,0,e*this.cell_width,y.height);this.bg.lineStyle(7,13582392,.9),this.bg.lineBetween(0,3*this.cell_width,y.width,3*this.cell_width)}create_scenes(){this.game_play=new V(this.scene),this.prepare_field=new W(this.scene),this.prepare_arsenal=new Y(this.scene),this.add([this.game_play,this.prepare_field,this.prepare_arsenal]),this.update_scenes("prepare_field")}update_scenes(e){const t={prepare_field:this.prepare_field,prepare_arsenal:this.prepare_arsenal,game_play:this.game_play};let i=!1;Object.keys(t).forEach((s=>{i=s===e,t[s]&&t[s].visible&&!i?(this.bringToTop(t[s]),t[s].visible=i,t[s].handler_close()):t[s]&&(t[s].clearMask(),t[s].visible=i),i&&t[s].show()}))}create_interface(){this.home_button=new S(this.scene,{x:6.5*this.cell_width,y:1.5*this.cell_width,atlas:"new",frame_out:"plank",callback:()=>{k.update_scenes("game_menu"),this.prepare_field.handler_close()}}),this.home_button.out_img.setScale(.65,1);const e=new(a().GameObjects.Image)(this.scene,-4*this.cell_width,0,"game_play","back_icon");this.home_button.add(e);const t=new(a().GameObjects.Text)(this.scene,0,0,"MAIN MENU",{fontFamily:"rubik",fontSize:36});t.setOrigin(.5),this.home_button.add(t),this.add(this.home_button)}}class K extends a().GameObjects.Container{constructor(e){super(e)}init(){}pre_show(e){console.log(e)}post_show(){}handler_close(){k.windows_manager.close_window()}}class J extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(-y.width/2,-y.height/2,y.width,y.height),this.dark.setInteractive(),this.dark.on("pointerup",this.handler_close),this.add(this.dark)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(4*e-y.width/2,2*e-y.height/2,20*e,11*e),this.bg.setInteractive(),this.bg.lineStyle(2,6386084,.7);for(let t=2;t<=12;t++)this.bg.lineBetween(4*e-y.width/2,t*e-y.height/2,24*e-y.width/2,t*e-y.height/2);for(let t=4;t<=23;t++)this.bg.lineBetween(t*e-y.width/2,2*e-y.height/2,t*e-y.width/2,13*e-y.height/2);this.bg.lineStyle(12,467577,1),this.bg.strokeRect(4*e-y.width/2+6,2*e-y.height/2+6,20*e-12,11*e-12),this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,5,-5.32*e,"new","plank");t.scaleX=1.9,this.add(t)}create_interface(){const e=x.cell_width+2;let t,i,s;this.close_button=new S(this.scene,{x:9.1*e,y:-5.1*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button),i=new(a().GameObjects.Text)(this.scene,5,-5.3*e,"RESULT OF THE BATTLE",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),this.result_plank=new(a().GameObjects.Container)(this.scene,5,-3.9*e),t=new(a().GameObjects.Image)(this.scene,0,0,"new","plank"),t.setScale(.4,.8),this.result_plank.add(t),i=new(a().GameObjects.Text)(this.scene,0,0,"WINNER",{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.result_plank.add(i),this.add(this.result_plank),t=new(a().GameObjects.Image)(this.scene,5,-3.9*e,"new","micro_plank"),t.setScale(5.5,1.5),this.add(t),i=new(a().GameObjects.Text)(this.scene,5,-3.9*e,"BATTLE IS OVER!",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,5,-2.33*e,"new","plank"),t.setScale(.57,1),this.add(t),i=new(a().GameObjects.Text)(this.scene,5,-2.33*e,"REWARD!",{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,5,1*e,"game_play","chest_opened"),t.setScale(2),this.add(t),i=new(a().GameObjects.Text)(this.scene,5,.2*e,"+0 $",{fontFamily:"rubik",fontSize:48}),i.setOrigin(.5),this.add(i),s=new S(this.scene,{x:5,y:4*e,atlas:"new",frame_out:"lightblue_button",callback:()=>{}}),s.alpha=.7,i=new(a().GameObjects.Text)(this.scene,0,0,"+100 $",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),s.add(i),this.add(s),s=new S(this.scene,{x:-6.2*e,y:4*e,atlas:"new",frame_out:"blue_button",callback:()=>{}}),s.alpha=.7,i=new(a().GameObjects.Text)(this.scene,0,0,"REMATCH",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),s.add(i),this.add(s),s=new S(this.scene,{x:6.2*e,y:4*e,atlas:"new",frame_out:"red_button",callback:()=>{}}),s.alpha=.7,i=new(a().GameObjects.Text)(this.scene,0,0,"NEXT",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),s.add(i),this.add(s),t=new(a().GameObjects.Image)(this.scene,-6.2*e,-1.5*e,"new","profile_ava"),this.add(t),t=new(a().GameObjects.Image)(this.scene,-6.2*e,1*e,"new","plank"),t.setScale(.4,1),this.add(t),i=new(a().GameObjects.Text)(this.scene,-6.2*e,1*e,x.user_data.name.toUpperCase(),{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,-6.2*e,2*e,"new","plank"),t.setScale(.4,1),this.add(t),i=new(a().GameObjects.Text)(this.scene,-6.2*e,2*e,x.user_data.rank.stage.toUpperCase(),{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,6.4*e,-1.5*e,"new","profile_ava"),t.setFlipX(!0),this.add(t),t=new(a().GameObjects.Image)(this.scene,6.4*e,1*e,"new","plank"),t.setScale(.4,1),this.add(t),i=new(a().GameObjects.Text)(this.scene,6.4*e,1*e,"Bot".toUpperCase(),{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,6.4*e,2*e,"new","plank"),t.setScale(.4,1),this.add(t),i=new(a().GameObjects.Text)(this.scene,6.4*e,2*e,x.user_data.rank.stage.toUpperCase(),{fontFamily:"rubik",fontSize:28}),i.setOrigin(.5),this.add(i)}init(){const e=x.cell_width+2;this.create_bg(),this.create_interface(),this.close_button=new S(this.scene,{x:24*e,y:2*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button)}pre_show(e){e&&(this.win=e.win)}post_show(){const e=x.cell_width+2;this.scene.tweens.add({targets:this.result_plank,x:(this.win?-6.2:6.4)*e,duration:500,ease:"back.out"})}handler_close(){k.windows_manager.close_window(),k.update_scenes("game_menu")}}class Z extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(0,0,y.width,y.height),this.dark.setInteractive(new(a().Geom.Rectangle)(0,0,y.width,y.height),a().Geom.Rectangle.Contains),this.dark.on("pointerup",this.handler_close)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(16054009,1),this.bg.fillRect(-5.4*e,-3.3*e,10.8*e,5.6*e),this.bg.lineStyle(12,467577,1),this.bg.strokeRect(-5.4*e+6,-3.3*e+6,10.8*e-12,5.6*e-12),this.bg.setInteractive(new(a().Geom.Rectangle)(-5.4*e,-3.3*e,10.8*e,5.6*e),a().Geom.Rectangle.Contains),this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,-1,-2.8*e,"new","plank");t.setScale(1.025,1),this.add(t)}init(){const e=x.cell_width+2;let t,i;this.create_bg(),this.close_button=new S(this.scene,{x:4.9*e,y:-2.8*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button),t=new(a().GameObjects.Text)(this.scene,0,-2.8*e,"QUIT GAME?",{fontFamily:"rubik",fontSize:36}),t.setOrigin(.5),this.add(t),t=new(a().GameObjects.Text)(this.scene,0,-1*e,"The bet will be returned!",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),t.setOrigin(.5),this.add(t),i=new S(this.scene,{x:-2.5*e,y:1*e,atlas:"new",frame_out:"blue_button",callback:()=>{this.handler_close(),k.update_scenes("game_menu")}}),this.add(i),t=new(a().GameObjects.Text)(this.scene,0,0,"YES",{fontFamily:"rubik",fontSize:36}),t.setOrigin(.5),i.add(t),i=new S(this.scene,{x:2.5*e,y:1*e,atlas:"new",frame_out:"blue_button",callback:()=>{this.handler_close()}}),this.add(i),t=new(a().GameObjects.Text)(this.scene,0,0,"NO",{fontFamily:"rubik",fontSize:36}),t.setOrigin(.5),i.add(t)}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class Q extends a().GameObjects.Container{constructor(e){super(e)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(9*e-y.width/2,2*e-y.height/2,10*e,13*e),this.bg.setInteractive(new(a().Geom.Rectangle)(9*e-y.width/2,2*e-y.height/2,10*e,13*e),a().Geom.Rectangle.Contains),this.bg.lineStyle(2,6386084,.7);for(let t=2;t<=14;t++)this.bg.lineBetween(9*e-y.width/2,t*e-y.height/2,19*e-y.width/2,t*e-y.height/2);for(let t=9;t<=19;t++)this.bg.lineBetween(t*e-y.width/2,2*e-y.height/2,t*e-y.width/2,15*e-y.height/2);this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,7,5.32*-e,"game_play","medium_plank");t.scale=.95,this.add(t)}create_slider(){const e=x.cell_width+2;let t;this.save_slider=new z(this.scene,{width:10*e,height:12*e}),this.add(this.save_slider),this.save_slider.setXY(.3*e,.5*e,14.3*e,-9*e),this.outer_objects.push(this.save_slider.rect_mask),["atom","bomber","torpedo","fighter","radar"].forEach(((i,s)=>{t=new(a().GameObjects.Image)(this.scene,4.6*e,s*e*4+1.8*e,"skill_item"),this.save_slider.add_child(t),t.setInteractive(),t.on("pointerdown",(()=>{this.save_slider.pointer_down=!0})),t.on("pointerup",(()=>{this.save_slider.was_move&&(this.save_slider.was_move=!1),this.save_slider.pointer_down=!1})),t.on("pointerout",(()=>{this.save_slider.pointer_down=!1,this.save_slider.was_move=!1})),t.on("pointermove",(e=>{this.save_slider.emit("pointermove",e)}))}))}init(){this.outer_objects=[];const e=x.cell_width+2;this.create_bg(),this.create_slider(),this.close_button=new S(this.scene,{x:4.5*e,y:-5.25*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button)}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class ee extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(-y.width/2,-y.height/2,y.width,y.height),this.dark.setInteractive(),this.dark.on("pointerup",this.handler_close),this.add(this.dark)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(4*e-y.width/2,2*e-y.height/2,20*e,11*e),this.bg.setInteractive(),this.bg.lineStyle(2,6386084,.7);for(let t=2;t<=12;t++)this.bg.lineBetween(4*e-y.width/2,t*e-y.height/2,24*e-y.width/2,t*e-y.height/2);for(let t=4;t<=23;t++)this.bg.lineBetween(t*e-y.width/2,2*e-y.height/2,t*e-y.width/2,13*e-y.height/2);this.bg.lineStyle(12,467577,1),this.bg.strokeRect(4*e-y.width/2+6,2*e-y.height/2+6,20*e-12,11*e-12),this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,5,-5.32*e,"new","plank");t.scaleX=1.9,this.add(t)}create_interface(){const e=x.cell_width+2;let t,i;this.close_button=new S(this.scene,{x:9.1*e,y:-5.1*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button),t=new(a().GameObjects.Image)(this.scene,0,-4.3*e,"new","header"),t.setScale(1),this.add(t),i=new(a().GameObjects.Text)(this.scene,0,-3.3*e,"BLACK SEA",{fontFamily:"rubik",fontSize:48,color:"#051F79"}),i.setOrigin(.5),this.add(i);for(let s=0;s<3;s++)t=new(a().GameObjects.Image)(this.scene,6*(s-1)*e,1*e,"new","arena_item"),t.setScale(1),this.add(t),0===s?(t=new(a().GameObjects.Image)(this.scene,6*(s-1)*e,1*e,"new","chest_mini"),t.setScale(1),this.add(t),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,-.5*e,"REWARD",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,2*e,"0 $",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.add(i)):1===s?(t=new(a().GameObjects.Image)(this.scene,6*(s-1)*e,1*e,"new","home_icon"),t.setScale(1),this.add(t),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,-.5*e,"OPEN BULDING",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,2*e,"0/0",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.add(i)):2===s&&(t=new(a().GameObjects.Image)(this.scene,6*(s-1)*e,1*e,"new","ticket_icon"),t.setScale(1),this.add(t),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,-.5*e,"ENTRY STAKE",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),this.add(i),i=new(a().GameObjects.Text)(this.scene,6*(s-1)*e,2*e,"0 $",{fontFamily:"rubik",fontSize:36,color:"#051F79"}),i.setOrigin(.5),this.add(i));const s=new(a().GameObjects.Arc)(this.scene,-7.3*e,6*e,20,0,360,!1,3202566,1);s.setStrokeStyle(5,7269,1);const n=new(a().GameObjects.Arc)(this.scene,1.8*e,6*e,20,0,360,!1,7269,1);n.setStrokeStyle(5,7269,1),t=new(a().GameObjects.Image)(this.scene,-4.5*e,6*e,"new","big_blue_button"),t.alpha=1,t.setInteractive(),t.on("pointerup",(()=>{n.setFillStyle(7269,1),s.setFillStyle(3202566,1),x.game_play.advanced=!0})),this.add(t),this.add(s),i=new(a().GameObjects.Text)(this.scene,-4.5*e,6*e,"ADVANCED MODE",{fontFamily:"rubik",fontSize:36}),i.alpha=1,i.setOrigin(.5),this.add(i),t=new(a().GameObjects.Image)(this.scene,4.5*e,6*e,"new","big_blue_button"),t.alpha=1,t.setInteractive(),t.on("pointerup",(()=>{s.setFillStyle(7269,1),n.setFillStyle(3202566,1),x.game_play.advanced=!1})),this.add(t),this.add(n),i=new(a().GameObjects.Text)(this.scene,4.5*e,6*e,"CLASSIC MODE",{fontFamily:"rubik",fontSize:36}),i.alpha=1,i.setOrigin(.5),this.add(i);const o=new S(this.scene,{x:0,y:4*e,atlas:"new",frame_out:"red_button",callback:()=>{this.handler_close(),k.update_scenes("game_play")}});i=new(a().GameObjects.Text)(this.scene,0,0,"PLAY",{fontFamily:"rubik",fontSize:36}),i.setOrigin(.5),o.add(i),this.add(o)}init(){const e=x.cell_width+2;this.create_bg(),this.create_interface(),this.close_button=new S(this.scene,{x:24*e,y:2*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button)}pre_show(e){e&&(this.win=e.win)}post_show(){}handler_close(){k.windows_manager.close_window(),k.update_scenes("game_menu")}}class te extends a().GameObjects.Container{constructor(e){super(e)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(9*e-y.width/2,2*e-y.height/2,10*e,13*e),this.bg.setInteractive(new(a().Geom.Rectangle)(9*e-y.width/2,2*e-y.height/2,10*e,13*e),a().Geom.Rectangle.Contains),this.bg.lineStyle(2,6386084,.7);for(let t=2;t<=14;t++)this.bg.lineBetween(9*e-y.width/2,t*e-y.height/2,19*e-y.width/2,t*e-y.height/2);for(let t=9;t<=19;t++)this.bg.lineBetween(t*e-y.width/2,2*e-y.height/2,t*e-y.width/2,15*e-y.height/2);this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,7,5.32*-e,"game_play","medium_plank");t.scale=.95,this.add(t)}create_slider(){const e=x.cell_width+2;let t;this.arsenal_slider=new z(this.scene,{width:10*e,height:12*e}),this.add(this.arsenal_slider),this.arsenal_slider.setXY(.3*e,.5*e,14.3*e,-9*e),this.outer_objects.push(this.arsenal_slider.rect_mask),["atom","bomber","torpedo","fighter","submarine","radar"].forEach(((i,s)=>{t=new(a().GameObjects.Image)(this.scene,4.6*e,s*e*4+1.8*e,"skill_item"),this.arsenal_slider.add_child(t),t.setInteractive(),t.on("pointerdown",(()=>{this.arsenal_slider.pointer_down=!0})),t.on("pointerup",(()=>{!this.arsenal_slider.was_move&&x.user_data.skills[i].amount>0?(this.start_skill(i),this.handler_close()):this.arsenal_slider.was_move=!1,this.arsenal_slider.pointer_down=!1})),t.on("pointerout",(()=>{this.arsenal_slider.pointer_down=!1,this.arsenal_slider.was_move=!1})),t.on("pointermove",(e=>{this.arsenal_slider.emit("pointermove",e)})),t=new(a().GameObjects.Image)(this.scene,t.x,t.y+25,"skill_"+i),this.arsenal_slider.add_child(t),t=new(a().GameObjects.Text)(this.scene,t.x-230,t.y+50,`${x.user_data.skills[i].amount}/${x.skills[i].max}`,{fontFamily:"rubik",fontSize:36,color:"#072279"}),t.setOrigin(.5,.5),this.arsenal_slider.add_child(t)}))}start_skill(e){k.game_play.game_play.start_skill(e)}init(){this.outer_objects=[];const e=x.cell_width+2;this.create_bg(),this.create_slider(),this.close_button=new S(this.scene,{x:4.5*e,y:-5.25*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button)}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class ie extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(0,0,y.width,y.height),this.dark.setInteractive(new(a().Geom.Rectangle)(0,0,y.width,y.height),a().Geom.Rectangle.Contains),this.dark.on("pointerup",this.handler_close)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(16054009,1),this.bg.fillRect(-5.4*e,-3.3*e,10.8*e,5.6*e),this.bg.lineStyle(12,467577,1),this.bg.strokeRect(-5.4*e+6,-3.3*e+6,10.8*e-12,5.6*e-12),this.bg.setInteractive(new(a().Geom.Rectangle)(-5.4*e,-3.3*e,10.8*e,5.6*e),a().Geom.Rectangle.Contains),this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,-1,-2.8*e,"new","plank");t.setScale(1.025,1),this.add(t)}init(){const e=x.cell_width+2;let t;this.create_bg(),this.close_button=new S(this.scene,{x:4.9*e,y:-2.8*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button),t=new(a().GameObjects.Text)(this.scene,0,-2.8*e,"FUEL DELIVERY!",{fontFamily:"rubik",fontSize:36}),t.setOrigin(.5),this.add(t);const i=new(a().GameObjects.Image)(this.scene,0,-1.3*e,"new","oil_icon_dark");i.scale=2,this.add(i),t=new(a().GameObjects.Text)(this.scene,0,0*e,"+600",{fontFamily:"rubik",fontSize:64,color:"#051F79"}),t.setOrigin(.5),this.add(t);const s=new S(this.scene,{x:0,y:1.3*e,atlas:"new",frame_out:"lightblue_button",callback:()=>{x.user_data.oil.amount+=600,x.user_data.oil.amount>x.user_data.oil.max&&(x.user_data.oil.amount=x.user_data.oil.max),k.game_play.prepare_arsenal.update_oil(),this.handler_close()}});this.add(s),t=new(a().GameObjects.Text)(this.scene,0,0,"CLAIM!",{fontFamily:"rubik",fontSize:36}),t.setOrigin(.5),s.add(t)}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class se extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(-y.width/2,-y.height/2,y.width,y.height),this.dark.setInteractive(),this.dark.on("pointerup",this.handler_close),this.add(this.dark)}create_bg(){const e=x.cell_width+2;this.bg=new(a().GameObjects.Graphics)(this.scene),this.bg.fillStyle(15329507,1),this.bg.fillRect(1*e-y.width/2,1*e-y.height/2,26*e,12*e),this.bg.setInteractive(),this.bg.lineStyle(2,6386084,.7);for(let t=1;t<=13;t++)this.bg.lineBetween(1*e-y.width/2,t*e-y.height/2,27*e-y.width/2,t*e-y.height/2);for(let t=2;t<=27;t++)this.bg.lineBetween(t*e-y.width/2,1*e-y.height/2,t*e-y.width/2,13*e-y.height/2);this.bg.lineStyle(12,467577,1),this.bg.strokeRect(1*e-y.width/2+6,1*e-y.height/2+6,26*e-12,12*e-12),this.add(this.bg);const t=new(a().GameObjects.Image)(this.scene,7,-6.32*e,"new","plank");t.scaleX=2.46,this.add(t);const i=new(a().GameObjects.Text)(this.scene,7,-6.32*e,"DAILY REWARD",{fontFamily:"rubik",fontSize:36,color:"#FFFFFF"});i.setOrigin(.5),this.add(i)}create_interface(){const e=x.cell_width+2;this.close_button=new S(this.scene,{x:12.1*e,y:-6.1*e,atlas:"game_play",frame_out:"close_button",frame_over:"close_button",frame_down:"close_button",callback:()=>{this.handler_close()}}),this.add(this.close_button)}create_main_prize(){const e=x.cell_width+2,t=new(a().GameObjects.Rectangle)(this.scene,-650,-5,5*e,9*e);t.setStrokeStyle(5,467577,1),this.add(t);const i=new(a().GameObjects.Image)(this.scene,-650,-150,"game_play","chest_closed");i.setScale(1.5),this.add(i);let s=new(a().GameObjects.Text)(this.scene,-650,-350,"ADMIRAL REWARD",{fontFamily:"rubik",fontSize:32,color:"#051F79"});s.setOrigin(.5),this.add(s),s=new(a().GameObjects.Text)(this.scene,-650,18,"Log in every day and\nwin a special prize!",{fontFamily:"rubik",fontSize:28,color:"#051F79",align:"center"}),s.setOrigin(.5),this.add(s),this.create_day_bar()}create_items(){for(let e=0;e<14;e++){const t=new(a().GameObjects.Container)(this.scene,e%7*190-370,330*Math.floor(e/7)-170),i=new(a().GameObjects.Rectangle)(this.scene,0,0,170,290);i.setStrokeStyle(9,467577,1),t.add(i);const s=new(a().GameObjects.Image)(this.scene,0,-120,"new","plank");s.setScale(.23,.8),t.add(s);const n=new(a().GameObjects.Text)(this.scene,0,-120,"DAY "+(e+1),{fontFamily:"rubik",fontSize:28,color:"#FFFFFF"});n.setOrigin(.5),t.add(n);const o=x.daily_rewards[e];if("coins"===o.type||"gems"===o.type){const e=new(a().GameObjects.Image)(this.scene,0,0,"shop",o.icon);e.width>150&&e.setScale(150/e.width);const i=new(a().GameObjects.Text)(this.scene,0,100,String(o.amount),{fontFamily:"rubik",fontSize:36,color:"#051F79"});i.setOrigin(.5),t.add([e,i])}this.add(t)}}create_day_bar(){const e=x.cell_width;this.day_bar=new n(this.scene,{atlas:"new",frame_bg:"plank",frame_bar:"oil_progress"}),this.day_bar.bg.setScale(.73,1),this.day_bar.update_progress((x.user_data.daily_reward.amount+1)/x.daily_rewards.length),this.day_bar.setPosition(-650,2.7*e),this.day_bar.setScale(.6,.9),this.add(this.day_bar),this.day_bar_txt=new(a().GameObjects.Text)(this.scene,-650,1.7*e,`DAY ${x.user_data.daily_reward.amount+1}/${x.daily_rewards.length}`,{fontFamily:"rubik",fontSize:36,color:"#051F79"}),this.day_bar_txt.setOrigin(.5,.5),this.add(this.day_bar_txt)}init(){this.create_bg(),this.create_interface(),this.create_items(),this.create_main_prize()}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class ae extends a().GameObjects.Container{constructor(e){super(e)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(0,0,y.width,y.height),this.dark.setInteractive(new(a().Geom.Rectangle)(0,0,y.width,y.height),a().Geom.Rectangle.Contains),this.dark.on("pointerup",this.handler_close)}create_bg(){const e=x.cell_width+2,t=new(a().GameObjects.Image)(this.scene,y.width/2,-2.8*e,"game_menu","settings_back");t.x-=t.width/2,t.setInteractive(),t.setScale(1,1),this.add(t)}init(){const e=x.cell_width+2;let t,i;this.create_bg(),this.close_button=new S(this.scene,{x:y.width/2-.7*e,y:-y.height/2+.7*e,atlas:"game_menu",frame_out:"icon_close",frame_over:"icon_close",frame_down:"icon_close",callback:()=>{this.handler_close()}}),this.add(this.close_button),i=new S(this.scene,{x:y.width/2-3.8*e,y:-y.height/2+2.5*e,atlas:"game_menu",frame_out:"settings_button",callback:()=>{this.handler_close(),k.big_windows.update_scenes("settings"),k.update_scenes("big_windows")}}),this.add(i),t=new(a().GameObjects.Text)(this.scene,0,0,"SETTINGS",{fontFamily:"rubik",fontSize:36,color:"#3C2415"}),t.setOrigin(.5),i.add(t),i=new S(this.scene,{x:y.width/2-3.8*e,y:-y.height/2+4*e,atlas:"game_menu",frame_out:"settings_button",callback:()=>{this.handler_close(),k.big_windows.update_scenes("achivments"),k.update_scenes("big_windows")}}),this.add(i),t=new(a().GameObjects.Text)(this.scene,0,0,"ACHIVEMENT",{fontFamily:"rubik",fontSize:36,color:"#3C2415"}),t.setOrigin(.5),i.add(t)}pre_show(){}post_show(){}handler_close(){k.windows_manager.close_window()}}class ne extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){this.pending_widows=[],this.window=null,this.create_window_table()}create_window_table(){this.window_table={test:K,result_battle:J,quit_battle:Z,save_field:Q,arsenal:te,video_oil:ie,arena_slider:ee,daily_reward:se,options:ae}}show_window(e,t){let i=!1,s=e||"",a=t;if(!this.window&&0===this.pending_widows.length&&s in this.window_table)this.window=new this.window_table[s](this.scene),i=!0;else if(this.window)this.pending_widows.push({window_id:e,current_params:a});else{const{window_id:e,params:t}=this.pending_widows.shift();s=e,a=t,this.window=new this.window_table[s](this.scene),i=!0}i&&this.window&&(this.window.x=y.width/2,this.window.y=-y.height/2,this.add(this.window),this.window.init(),this.window.pre_show(a),this.anim_pos_window(y.height/2,(()=>{var e;null===(e=this.window)||void 0===e||e.post_show()})))}anim_pos_window(e,t){var i;const s=e>y.height/2?"back.in":"back.out";this.scene.tweens.add({targets:this.window,y:e,duration:400,ease:s,onComplete:()=>t()}),(null===(i=this.window)||void 0===i?void 0:i.outer_objects)&&this.window.outer_objects.forEach((t=>{var i;this.scene.tweens.add({targets:(null===(i=this.window)||void 0===i?void 0:i.outer_objects)||[],y:e<=y.height/2?e-y.height/2-t.y:e,duration:400,ease:s})})),this.scene.tweens.add({targets:k.dark,alpha:e>y.height/2?0:1,duration:300})}close_window(){this.anim_pos_window(1.5*y.height,(()=>{this.window&&this.window.destroy(),this.window=null,this.pending_widows.length>0&&this.show_window()}))}}class oe extends a().GameObjects.Container{constructor(e){super(e),this.init()}init(){}get_big_window_move_anim(e,t=(()=>{})){console.log(t),console.log(x);const i=new(a().Display.BaseShader)("BufferShader",'\n/*\n * Original shader from: https://www.shadertoy.com/view/ltdXzX\n */\n\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\n// glslsandbox uniforms\nuniform sampler2D iChannel0;\nuniform float time;\nuniform vec2 resolution;\n\n// shadertoy globals\n#define iTime time\n#define iResolution resolution\n\n// --------[ Original ShaderToy begins here ]---------- //\n/*\n"Page Turning" by Emmanuel Keller aka Tambako - December 2015\nLicense Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\nContact: tamby@tambako.ch\n*/\n\nconst float pi = 3.14159;\nconst float twopi = 6.28319;\n\nconst float e0 = 0.018;\nconst float ppow = 2.0;\n\nconst float bcolorMix = 0.67;\nconst float maxBcolVal = 0.4;\n\nconst float diffint = 1.2;\nconst float ambientt = 0.1;\nconst float ambientb = 0.4;\n\nconst vec2 specpos = vec2(0.85, -0.2);\nconst float specpow = 5.;\nconst float specwidth = 0.4;\nconst float specint = 0.6;\n\nconst vec2 shadowoffset = vec2(0.07, -0.04);\nconst float shadowsmoothness = 0.012;\nconst float shadowint = 0.25;\n\nconst float aawidth = 0.7;\nconst int aasamples = 3;\n\nconst bool showpoints = false;\nconst bool colors = false;\nconst bool anim = true;\n\n#define swap_x\n\n// Simple "random" function\nfloat random(float co)\n{\n    return fract(sin(co*12.989) * 43758.545);\n}\n\nvec4 getPagebackColor()\n{\n    \n    float cn = 1.0;\n    vec4 pagebackColor;\n    pagebackColor.r = maxBcolVal*random(cn + 263.714);\n    pagebackColor.g = maxBcolVal*random(cn*4. - 151.894);\n    pagebackColor.b = maxBcolVal*random(cn*7. + 87.548);\n    pagebackColor.a = 0.0;\n    return pagebackColor;\n}\n\nvec2 rotateVec(vec2 vect, float angle)\n{\n    float xr = vect.x*cos(angle) + vect.y*sin(angle);\n    float yr = vect.x*sin(angle) - vect.y*cos(angle);\n    return vec2(xr, yr);\n}\n\n// Curl function on the axis bottom left corner - corner of the sheet\nfloat pageFunction(float x, float e)\n{\n    return pow(pow(x, ppow) - e, 1./ppow);\n}\n\n// Derivate of the curl function for light calculations\nfloat pageFunctionDer(float x, float e)\n{\n    return pow(x, ppow - 1.)/pow(pow(x, ppow) - e, (ppow - 1.)/ppow);\n}\n\nvec4 turnPage(vec2 fragCoord)\n{\n\t// General calculations\n    vec2 uv = fragCoord.xy / iResolution.yy;\n    float ratio = iResolution.x/iResolution.y;\n    \n    // As long as one doesn\'t click on the canvas, the animation runs\n    vec2 mpoint;\n    bool firstcycle;\n    \n    \n    firstcycle = mod(iTime/3.5, 2.)<1.;\n    mpoint = vec2(mod(iTime/3.5, 1.)*iResolution.x*2.0, pow(mod(iTime/3.5, 1.), 2.5)*iResolution.y/1.2 + 8.*smoothstep(0., 0.07, mod(iTime/3.5, 1.)));\n   \n    vec2 midmpoint = mpoint*0.5;\n    float mdist = distance(fragCoord, mpoint);\n    float e = e0*pow(mdist/iResolution.y, 2.) + 0.02*e0*smoothstep(0., 0.12, mdist/iResolution.y);\n    float angle = - atan(mpoint.x/mpoint.y) + pi*0.5;\n    \n    vec2 uv2 = uv;\n    #ifdef swap_x\n    uv2.x = ratio - uv2.x;\n    #endif\n    \n    vec2 uvr = rotateVec(uv2 - midmpoint/iResolution.yy, angle);\n    \n    float pagefunc = pageFunction(uvr.x, e);\n    vec2 uvr2 = vec2(pagefunc, uvr.y); \n    vec2 uvr3 = rotateVec(uvr2, -angle) - vec2(1., -1.)*midmpoint/iResolution.yy;\n    \n    vec2 uvr2b = vec2(-pagefunc, uvr.y); \n    vec2 uvr3b = rotateVec(uvr2b, -angle) - vec2(1., -1.)*midmpoint/iResolution.yy;\n    \n    #ifdef swap_x\n    uvr3b.x = ratio - uvr3b.x;\n    #endif\n        \n    vec4 i; \n    // Turned page\n    if (uvr.x>0. && uvr3b.y>0.)\n    {\n        vec2 uvcorr = vec2(ratio, 1.);\n        vec2 uvrcorr = rotateVec(uvcorr - midmpoint/iResolution.yy, angle);\n        float pagefunccorr = pageFunction(uvrcorr.x, e);\n        vec2 uvrcorr2 = vec2(-pagefunccorr, uvrcorr.y); \n        vec2 uvrcorr3 = rotateVec(uvrcorr2, -angle) - vec2(1., -1.)*midmpoint/iResolution.yy;\n    \n        float pagefuncder = pageFunctionDer(uvr.x, e);\n        float intfac = 1. - diffint*(1. - 1./pagefuncder);\n\n        if(uvr3.x>=0. || uvr3.y<=0.)\n        {\n            // Top of the turned page           \n        \tfloat mdists = distance(fragCoord, mpoint)*0.7 - 55.;\n        \tfloat es = e0*pow(mdists/iResolution.y, 2.) + 0.02*e0*smoothstep(0., 0.08, mdist/iResolution.y);\n        \tvec2 uvrs = rotateVec(uv2 - midmpoint/iResolution.yy - shadowoffset, angle);\n        \tfloat pagefuncs = pageFunction(uvrs.x + 0.015, es - 0.001);\n        \tvec2 uvr2s = vec2(pagefuncs, uvrs.y); \n        \tvec2 uvr3s = rotateVec(uvr2s, -angle) - vec2(1., -1.)*midmpoint/iResolution.yy;\n        \tfloat shadow = 1. - (1. - smoothstep(-shadowsmoothness, shadowsmoothness, uvr3s.x))*(1. - smoothstep(shadowsmoothness, -shadowsmoothness, uvr3s.y));\n            \n            float difft = intfac*(1. - ambientt) + ambientt;\n        \tdifft = difft*(shadow*shadowint + 1. - shadowint)/2. + mix(1. - shadowint, difft, shadow)/2.;\n            if (firstcycle)\n                //i = difft*(colors?vec4(1., 0.3, 0.3, 1.):texture2D(iChannel0, mod((uvr3b - uvrcorr3)/vec2(-ratio, 1.), 1.)));\n                i = vec4(0.0, 0.0, 0.0, 0.0);\n            else\n                //i = difft*(colors?vec4(1., 0.3, 0.3, 1.):texture2D(iChannel0, mod((uvr3b - uvrcorr3)/vec2(-ratio, 1.), 1.)));\n                i = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n        else\n        {\n            // Bottom of the turned page\n            float diffb = intfac*(1. - ambientb) + ambientb;\n        \tfloat spec = pow(smoothstep(specpos.x - 0.35, specpos.x, intfac)*smoothstep(specpos.x + 0.35, specpos.x, intfac), specpow);\n        \tspec*= specint*pow(1. - pow(clamp(abs(uvr.y - specpos.y), 0., specwidth*2.), 2.)/specwidth, specpow);\n\t\t\t/*if (firstcycle)\n                i = diffb*(colors?vec4(0.3, 1.0, 0.3, 1.):mix(texture2D(iChannel0, mod((uvr3 - uvrcorr3)/vec2(-ratio, 1.), 1.)), getPagebackColor(), bcolorMix));\n            else\n                i = diffb*(colors?vec4(0.3, 1.0, 0.3, 1.):mix(texture2D(iChannel0, mod((uvr3 - uvrcorr3)/vec2(-ratio, 1.), 1.)), getPagebackColor(), bcolorMix));\n            */\n            i = diffb*(colors?vec4(0.3, 1.0, 0.3, 1.):texture2D(iChannel0, mod((uvr3 - uvrcorr3)/vec2(-ratio, 1.), 1.)));\n         \t// i = mix(i, vec4(1.0), spec);\n            \n        }\n    }\n    else\n    {\n        // "Background" with simple shadow\n\n        vec2 mpointbg = vec2(0.2, 0.01);\n        vec2 midmpointbg = mpointbg*0.5;\n        float mdistbg = distance(fragCoord, mpointbg);\n        float ebg = e0*pow(mdistbg/iResolution.y, 2.) + 0.01*e0*smoothstep(0., 0.12, mdistbg/iResolution.y);\n        float anglebg = 0.001; //- atan(mpointbg.x/mpointbg.y) + pi*0.5;\n        vec2 uvrbg = rotateVec(uv - midmpointbg/iResolution.yy, anglebg);\n        //float pagefuncbg = mix(uvrbg.x, pageFunction(uvrbg.x, ebg), clamp(uvrbg.x*5., 0., 1.));\n        float pagefuncbg;\n        if (uvrbg.x<0.15)\n           pagefuncbg = uvrbg.x;\n        else\n           pagefuncbg = mix(uvrbg.x, pageFunction(uvrbg.x, ebg), smoothstep(mpoint.x/iResolution.x + 0.1, mpoint.x/iResolution.x, uvrbg.x));\n        \n        vec2 uvr2bbg = vec2(-pagefuncbg, uvrbg.y); \n        vec2 uvr3bbg = rotateVec(uvr2bbg, -anglebg) - vec2(1., -1.)*midmpointbg/iResolution.yy;\n        vec2 uvcorrbg = vec2(ratio, 1.);\n        vec2 uvrcorrbg = rotateVec(uvcorrbg - midmpointbg/iResolution.yy, anglebg);\n        float pagefunccorrbg = pageFunction(uvrcorrbg.x, ebg);\n        vec2 uvrcorr2bg = vec2(-pagefunccorrbg, uvrcorrbg.y); \n        vec2 uvrcorr3bg = rotateVec(uvrcorr2bg, -anglebg) - vec2(1., -1.)*midmpointbg/iResolution.yy;       \n        float pagefuncderbg = pageFunctionDer(uvrbg.x, ebg);\n        float intfacbg = 1. - diffint*(1. - 1./pagefuncderbg);\n        float difftbg = intfacbg*(1. - ambientt) + ambientt;\n        \n        if (firstcycle) \n            //i = colors?difftbg*vec4(0.3, 0.3, 1., 1.):texture2D(iChannel0, mod((uvr3bbg - uvrcorr3bg)/vec2(-ratio, 1.), 1.));\n            i = vec4(0.0, 0.0, 0.0, 0.0);\n        else\n            //i = colors?difftbg*vec4(0.3, 0.3, 1., 1.):texture2D(iChannel0, mod((uvr3bbg - uvrcorr3bg)/vec2(-ratio, 1.), 1.));\n            i = vec4(0.0, 0.0, 0.0, 0.0);\n        float bgshadow = 1. + shadowint*smoothstep(-0.08+shadowsmoothness*4., -0.08, uvr3b.y) - shadowint;\n        \n        if (uvr3b.y<0.)\n           i*= bgshadow;\n    }\n    return i;\n}\n \nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n    // Antialiasing\n    vec4 vs = vec4(0.);\n    for (int j=0;j<aasamples ;j++)\n    {\n       float oy = float(j)*aawidth/max(float(aasamples-1), 1.);\n       for (int i=0;i<aasamples ;i++)\n       {\n          float ox = float(i)*aawidth/max(float(aasamples-1), 1.);\n          vs+= turnPage(fragCoord + vec2(ox, oy));\n       }\n    }\n    vec4 i = vs/vec4(aasamples*aasamples);    \n    \n    // Show the mouse points. Was only used for development\n    vec4 ocol; \n    if (showpoints)\n    {\n        float ratio = iResolution.x/iResolution.y;\n        vec2 mpoint = vec2(0.0, 0.0);\n        vec2 midmpoint = mpoint*0.5;\n        float mdist = distance(fragCoord, mpoint);\n        float midmdist = distance(fragCoord, midmpoint);\n        \n        ocol = mix(i, vec4(1., 0., 0., 1.), smoothstep(6., 4., mdist));\n        ocol = mix(ocol, vec4(1., 1., 0., 1.), smoothstep(6., 4., midmdist));\n    }\n    else\n        ocol = i;\n        \n    fragColor = i;\n}\n// --------[ Original ShaderToy ends here ]---------- //\n\nvoid main(void)\n{\n    mainImage(gl_FragColor, gl_FragCoord.xy);\n}\n'),s=this.scene.add.shader(i,y.width/2,y.height/2,1.2*y.width,1.2*y.height,["page_bg"]),n=this.scene.textures.get("page_bg");console.trace(n),n.source[0].glTexture&&s.setSampler2DBuffer("iChannel0",n.source[0].glTexture,n.source[0].width,n.source[0].height,0)}}class he{constructor(e){this.scene=e,this.lang=this.get_user_lang(),this.global_texts=[],this.loaded_languages={},this.load_lang((()=>{this.update_texts()}))}load_lang(e){this.lang in this.loaded_languages?e():(this.scene.load.json(this.lang,"public/assets/lang/"+this.lang+".json"),this.scene.load.once("complete",(()=>{this.loaded_languages[this.lang]=!0,e()})),this.scene.load.start())}set_language(e){this.lang=e,this.load_lang((()=>{this.update_user_lang(),this.update_texts()}))}get_user_lang(){return"en_US"}update_user_lang(){console.log("to server",this.lang)}get_text_for_id(e){let t;return this.lang in this.loaded_languages?t=this.scene.cache.json.get(this.lang):this.load_lang((()=>{t=this.scene.cache.json.get(this.lang)})),t[e]}update_text(e){let t;e.text_object.lang!==this.lang&&(t=this.get_text_for_id(e.text_id),e.text_object.lang=this.lang,e.text_object.setText(t.text),e.text_object.setStyle(t.style))}update_texts(){this.global_texts.forEach((e=>{this.update_text(e)}))}add_text(e,t){const i={text_object:e,text_id:t};this.global_texts.push(i),this.update_text(i)}}class re extends a().GameObjects.Container{constructor(e){super(e)}init_flags(){x.flags=Object.keys(this.scene.textures.get("flags").frames).filter((e=>"__BASE"!==e)),console.log(x.flags)}create_dark(){this.dark=new(a().GameObjects.Graphics)(this.scene),this.dark.fillStyle(2302767,.6),this.dark.fillRect(0,0,y.width,y.height),this.dark.setInteractive(new(a().Geom.Rectangle)(0,0,y.width,y.height),a().Geom.Rectangle.Contains),this.dark.on("pointerup",(()=>{this.windows_manager.window&&this.windows_manager.window.handler_close?this.windows_manager.window.handler_close():this.windows_manager.close_window()})),this.dark.alpha=0,this.add(this.dark)}init(){this.init_flags(),this.anims_manager=new oe(this.scene),this.add(this.anims_manager),this.language_manager=new he(this.scene),this.game_menu=new N(this.scene),this.add(this.game_menu),this.game_play=new q(this.scene),this.add(this.game_play),this.big_windows=new P(this.scene),this.add(this.big_windows),this.create_dark(),this.windows_manager=new ne(this.scene),this.add(this.windows_manager),this.update_scenes("game_menu")}update_scenes(e){const t={game_menu:this.game_menu,game_play:this.game_play,big_windows:this.big_windows};let i=!1;Object.keys(t).forEach((s=>{i=s===e,t[s]&&(t[s].visible=i)}))}to_local_pt(e,t){const i=[];let s,n,o=e;for(n=t?new(a().Geom.Point)(t.x,t.y):new(a().Geom.Point)(0,0);o&&!(o instanceof a().Scene);)i.push(o),o=o.parentContainer;for(;i.length>0;)s=i.pop(),n.x=(n.x-s.x)/s.scaleX,n.y=(n.y-s.y)/s.scaleY;return n}to_global_pt(e,t){let i;i=t?new(a().Geom.Point)(t.x,t.y):new(a().Geom.Point)(0,0);let s=e;for(;s&&s!=this.scene;)i.x=i.x*s.scaleX+s.x,i.y=i.y*s.scaleY+s.y,s=s.parentContainer,console.trace(i,s);return i}}},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={exports:{}};return t[e].call(n.exports,n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,i,a,n)=>{if(!i){var o=1/0;for(c=0;c<e.length;c++){for(var[i,a,n]=e[c],h=!0,r=0;r<i.length;r++)(!1&n||o>=n)&&Object.keys(s.O).every((e=>s.O[e](i[r])))?i.splice(r--,1):(h=!1,n<o&&(o=n));if(h){e.splice(c--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,a,n]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[o,h,r]=i,l=0;if(o.some((t=>0!==e[t]))){for(a in h)s.o(h,a)&&(s.m[a]=h[a]);if(r)var c=r(s)}for(t&&t(i);l<o.length;l++)n=o[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},i=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),s.O(void 0,[216],(()=>s(493)));var a=s.O(void 0,[216],(()=>s(204)));a=s.O(a)})();